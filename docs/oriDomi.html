<!DOCTYPE html>  <html> <head>   <title>oriDomi.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               oriDomi.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1><a href="http://oridomi.com">oriDomi</a></h1>

<h4>by <a href="http://oxism.com">Dan Motzenbecker</a></h4>

<p>Fold up the DOM like paper.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><code>0.1.1</code></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Copyright 2012, MIT License</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>Setup</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Enable strict mode in this scope to keep us in line.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="s">&#39;use strict&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Set a reference to the global object within this scope.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root = </span><span class="nb">window</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Set a reference to jQuery (or another <code>$</code>-aliased DOM library).
If it doesn't exist, set to false so oriDomi knows we are working without jQuery.
oriDomi doesn't require it to work, but offers a useful plugin bridge.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nx">root</span><span class="p">.</span><span class="nx">$</span> <span class="o">or</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>devMode</code> determines whether oriDomi is vocal in the console with warnings and benchmarks.
Turn it on externally by calling <code>OriDomi.devMode()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">devMode = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>This variable is set to true and negated later if the browser does
not support oriDomi.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">oriDomiSupport = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Create a div for testing CSS3 properties.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">testEl = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Set a list of browser prefixes for testing CSS3 properties.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">prefixList = </span><span class="p">[</span><span class="s">&#39;Webkit&#39;</span><span class="p">,</span> <span class="s">&#39;Moz&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="s">&#39;ms&#39;</span><span class="p">,</span> <span class="s">&#39;Khtml&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>A map of the CSS3 properties needed to support oriDomi, with shorthand names as keys.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">css = </span>
  <span class="nv">transform: </span><span class="s">&#39;transform&#39;</span>
  <span class="nv">origin: </span><span class="s">&#39;transformOrigin&#39;</span>
  <span class="nv">transformStyle: </span><span class="s">&#39;transformStyle&#39;</span>
  <span class="nv">transitionProp: </span><span class="s">&#39;transitionProperty&#39;</span>
  <span class="nv">transitionDuration: </span><span class="s">&#39;transitionDuration&#39;</span>
  <span class="nv">transitionEasing: </span><span class="s">&#39;transitionTimingFunction&#39;</span>
  <span class="nv">perspective: </span><span class="s">&#39;perspective&#39;</span>
  <span class="nv">backface: </span><span class="s">&#39;backfaceVisibility&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This function checks for the presence of CSS properties on the test div.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">testProp = </span><span class="nf">(prop) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If the un-prefixed property is present, return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">prop</span> <span class="k">if</span> <span class="nx">testEl</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Capitalize the property name for camel-casing.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">capProp = </span><span class="nx">prop</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">slice</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Loop through the vendor prefix list and return when we find a match.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">prefix</span> <span class="k">in</span> <span class="nx">prefixList</span>
    <span class="k">if</span> <span class="nx">testEl</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">capProp</span><span class="p">]</span><span class="o">?</span>
      <span class="k">return</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">capProp</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>If no matches are found, return false to denote that the browser is missing this property.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Loop through the CSS hash and replace each value with the result of <code>testProp()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">css</span>
  <span class="nx">css</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">testProp</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>If the returned value is false, warn the user that the browser doesn't support
oriDomi, set <code>oriDomiSupport</code> to false, and break out of the loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">unless</span> <span class="nx">css</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&#39;oriDomi: Browser does not support oriDomi&#39;</span>
    <span class="nv">oriDomiSupport = </span><span class="kc">false</span>
    <span class="k">break</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>CSS3 gradients are used for shading.
Testing for them is different because they are prefixed values, not properties.
This invokes an anonymous function to loop through vendor-prefixed linear-gradients.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">css.gradientProp = </span><span class="nx">do</span> <span class="o">-&gt;</span>
  <span class="k">for</span> <span class="nx">prefix</span> <span class="k">in</span> <span class="nx">prefixList</span>
    <span class="nv">hyphenated = </span><span class="s">&quot;-</span><span class="si">#{</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="si">}</span><span class="s">-linear-gradient&quot;</span>
    <span class="nv">testEl.style.backgroundImage = </span><span class="s">&quot;</span><span class="si">#{</span> <span class="nx">hyphenated</span> <span class="si">}</span><span class="s">(left, </span><span class="err">#</span><span class="s">000, </span><span class="err">#</span><span class="s">fff)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>After setting a gradient background on the test div, attempt to retrieve it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">testEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundImage</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;gradient&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">return</span> <span class="nx">hyphenated</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If none of the hyphenated values worked, return the un-prefixed version.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s">&#39;linear-gradient&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Invoke a functional scope to set a hyphenated version of the transform property.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">css.transformProp = </span><span class="nx">do</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Use a regex to pluck the prefix <code>testProp</code> found.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">prefix = </span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/(\w+)Transform/i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">prefix</span>
    <span class="s">&quot;-</span><span class="si">#{</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="si">}</span><span class="s">-transform&quot;</span>
  <span class="k">else</span>
    <span class="s">&#39;transform&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Set a <code>transitionEnd</code> property based on the browser's prefix for <code>transitionProperty</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">css.transitionEnd = </span><span class="nx">do</span> <span class="o">-&gt;</span>
  <span class="k">switch</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionProp</span>
    <span class="k">when</span> <span class="s">&#39;transitionProperty&#39;</span>
      <span class="s">&#39;transitionEnd&#39;</span>
    <span class="k">when</span> <span class="s">&#39;WebkitTransitionProperty&#39;</span>
      <span class="s">&#39;webkitTransitionEnd&#39;</span>
    <span class="k">when</span> <span class="s">&#39;MozTransitionProperty&#39;</span>
      <span class="s">&#39;transitionend&#39;</span>
    <span class="k">when</span> <span class="s">&#39;OTransitionProperty&#39;</span>
      <span class="s">&#39;oTransitionEnd&#39;</span>
    <span class="k">when</span> <span class="s">&#39;MSTransitionProperty&#39;</span>
      <span class="s">&#39;msTransitionEnd&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>This function is used to extend option object literals with a set of defaults.
It is simple and one dimensional.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">extendObj = </span><span class="nf">(target, source) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Check if the extension object is an object literal by casting it and comparing it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">source</span> <span class="o">isnt</span> <span class="nb">Object</span> <span class="nx">source</span>
    <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&#39;oriDomi: Must pass an object to extend with&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Return the original target if its source isn't valid.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If the target isn't an object, set it to an empty object literal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">target</span> <span class="o">isnt</span> <span class="nb">Object</span> <span class="nx">target</span>
    <span class="nv">target = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Loop through the extension object and copy its values to the target if they don't exist.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">prop</span> <span class="k">of</span> <span class="nx">source</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span>
      <span class="nx">target</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Return the extended target object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h1>Defaults</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Map of oriDomi instance defaults.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">defaults =</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>The number of vertical panels (for folding left or right).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">vPanels: </span><span class="mi">3</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>The number of horizontal panels (for folding top or bottom).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">hPanels: </span><span class="mi">3</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The determines the distance in pixels (z axis) of the camera/viewer to the paper.
The smaller the value, the more distorted and exaggerated the effects will appear.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">perspective: </span><span class="mi">1000</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>The default shading style is hard, which shows distinct creases in the paper.
Other options include <code>'soft'</code> -- for a smoother, more rounded look -- or <code>false</code>
to disable shading altogether for a flat look.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shading: </span><span class="s">&#39;hard&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Determines the duration of all animations in milliseconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">speed: </span><span class="mi">700</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>This class is applied to elements that oriDomi has been invoked so they can be
easily targeted later if needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">oriDomiClass: </span><span class="s">&#39;oridomi&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>This is a multiplier that determines the darkness of shading.
If you need subtler shading, set this to a value below 1.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shadingIntensity: </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>This option allows you to supply the name of a custom easing method defined in one
of your stylesheets. It defaults to a blank string which is interpreted as <code>ease</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">easingMethod: </span><span class="s">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>To prevent a possible "flash of unstyled content" you can hide your target elements
and pass this setting as <code>true</code> to show them immediately after initializing them with oriDomi.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">showOnStart: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Currently, Firefox doesn't handle edge anti-aliasing well and oriDomi looks jagged.
This setting forces Firefox to smooth edges, but results in poor performance,
so it's not recommended until Firefox's transform performance improves.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">forceAntialiasing: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h1>oriDomi Class</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">OriDomi</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>The constructor takes two arguments: a target element and an options object literal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@el, options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If <code>devMode</code> is enabled, start a benchmark timer for the constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">time</span> <span class="s">&#39;oridomiConstruction&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>If the browser doesn't support oriDomi, return the element unmodified.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@el</span> <span class="nx">unless</span> <span class="nx">oriDomiSupport</span>
    </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>If the constructor wasn't called with the <code>new</code> keyword, invoke it again.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">@</span> <span class="k">instanceof</span> <span class="nx">OriDomi</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">oriDomi</span> <span class="nx">@el</span><span class="p">,</span> <span class="nx">@settings</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Extend any passed options with the defaults map.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@settings = </span><span class="nx">extendObj</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">defaults</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Return if the first argument isn't a DOM element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">@el</span><span class="o">?</span> <span class="o">or</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">isnt</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&#39;oriDomi: First argument must be a DOM element&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Destructure some instance variables from the settings object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">{</span><span class="nx">@shading</span><span class="p">,</span> <span class="nx">@shadingIntensity</span><span class="p">,</span> <span class="nx">@vPanels</span><span class="p">,</span> <span class="nx">@hPanels</span><span class="p">}</span> <span class="o">=</span> <span class="nx">@settings</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Record the current global styling of the target element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">elStyle = </span><span class="nx">root</span><span class="p">.</span><span class="nx">getComputedStyle</span> <span class="nx">@el</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Calculate the element's total width by adding all horizontal dimensions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@width = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
             <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
             <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">paddingRight</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
             <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">borderLeftWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
             <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">borderRightWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Find the total height in a similar manner.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@height = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
              <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
              <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">paddingBottom</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
              <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">borderTopWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
              <span class="nb">parseInt</span><span class="p">(</span><span class="nx">elStyle</span><span class="p">.</span><span class="nx">borderBottomWidth</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Calculate the panel width and panel height by dividing the total width and
height by the requested number of panels in each axis.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@panelWidth = </span><span class="nx">@width</span> <span class="o">/</span> <span class="nx">@vPanels</span>
    <span class="vi">@panelHeight = </span><span class="nx">@height</span> <span class="o">/</span> <span class="nx">@hPanels</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Set our current fold angle at <code>0</code> and <code>isFoldedUp</code> as <code>false</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@lastAngle = </span><span class="mi">0</span>
    <span class="vi">@isFoldedUp = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Set an array of anchor names.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@anchors = </span><span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>oriDomi starts oriented with the left anchor.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@lastAnchor = </span><span class="nx">@anchors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Create object literals to store panels and stages.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@panels = </span><span class="p">{}</span>
    <span class="vi">@stages = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Create a stage div to serve as a prototype. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stage = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>The stage should occupy the full width and height of the target element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stage.style.width = </span><span class="nx">@width</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
    <span class="nv">stage.style.height = </span><span class="nx">@height</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>By default, each stage is hidden and absolutely positioned so they stack
on top of each other.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stage.style.display = </span><span class="s">&#39;none&#39;</span>
    <span class="nv">stage.style.position = </span><span class="s">&#39;absolute&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Eliminate padding and margins since the stage is already the full width and height.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stage.style.padding = </span><span class="s">&#39;0&#39;</span>
    <span class="nv">stage.style.margin = </span><span class="s">&#39;0&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Apply 3D perspective to the stage prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">stage</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">perspective</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">perspective</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Loop through the anchors list and create a stage and empty panel set for each.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">anchor</span> <span class="k">in</span> <span class="nx">@anchors</span>
      <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">false</span>
      <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">className = </span><span class="s">&#39;oridomi-stage-&#39;</span> <span class="o">+</span> <span class="nx">anchor</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>If shading is enabled, create an object literal to hold shaders.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shading</span>
      <span class="vi">@shaders = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Loop through each anchor and create a nested object literal.
For the left and right anchors, create arrays to hold the left and right
shader for each panel. Do the same for top and bottom.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">anchor</span> <span class="k">in</span> <span class="nx">@anchors</span>
        <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;left&#39;</span> <span class="o">or</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;right&#39;</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">left = </span><span class="p">[]</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">right = </span><span class="p">[]</span>
        <span class="k">else</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">top = </span><span class="p">[]</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">bottom = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Create a shader div prototype to clone.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">shader = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
      <span class="nx">shader</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionProp</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;opacity&#39;</span>
      <span class="nx">shader</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionDuration</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">speed</span> <span class="o">+</span> <span class="s">&#39;ms&#39;</span>
      <span class="nx">shader</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionEasing</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">easingMethod</span>
      <span class="nv">shader.style.position = </span><span class="s">&#39;absolute&#39;</span>
      <span class="nv">shader.style.width = </span><span class="s">&#39;100%&#39;</span>
      <span class="nv">shader.style.height = </span><span class="s">&#39;100%&#39;</span>
      <span class="nv">shader.style.opacity = </span><span class="s">&#39;0&#39;</span>
      <span class="nv">shader.style.top = </span><span class="s">&#39;0&#39;</span>
      <span class="nv">shader.style.left = </span><span class="s">&#39;0&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>The content holder is a clone of the target element.
Every panel will contain one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">contentHolder = </span><span class="nx">@el</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span>
    <span class="nx">contentHolder</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span> <span class="s">&#39;oridomi-content&#39;</span>
    <span class="nv">contentHolder.style.margin = </span><span class="s">&#39;0&#39;</span>
    <span class="nv">contentHolder.style.position = </span><span class="s">&#39;relative&#39;</span>
    <span class="nv">contentHolder.style.float = </span><span class="s">&#39;none&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Create a prototype mask div to clone.
Masks serve to display only a small offset portion of the content they hold.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hMask = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
    <span class="nv">hMask.className = </span><span class="s">&#39;oridomi-mask-h&#39;</span>
    <span class="nv">hMask.style.position = </span><span class="s">&#39;absolute&#39;</span>
    <span class="nv">hMask.style.overflow = </span><span class="s">&#39;hidden&#39;</span>
    <span class="nv">hMask.style.width = </span><span class="s">&#39;100%&#39;</span>
    <span class="nv">hMask.style.height = </span><span class="s">&#39;100%&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Adding <code>translate3d(0, 0, 0)</code> prevents flickering during transforms.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hMask</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;translate3d(0, 0, 0)&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Add the <code>contentHolder</code> div to the mask prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hMask</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">contentHolder</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>If shading is enabled, create top and bottom shaders for the horizontal
mask prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shading</span>
      <span class="nv">topShader = </span><span class="nx">shader</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">false</span>
      <span class="nv">topShader.className = </span><span class="s">&#39;oridomi-shader-top&#39;</span>
      <span class="nv">topShader.style.background = </span><span class="nx">@_getShaderGradient</span> <span class="s">&#39;top&#39;</span>
      <span class="nv">bottomShader = </span><span class="nx">shader</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">false</span>
      <span class="nv">bottomShader.className = </span><span class="s">&#39;oridomi-shader-bottom&#39;</span>
      <span class="nv">bottomShader.style.background = </span><span class="nx">@_getShaderGradient</span> <span class="s">&#39;bottom&#39;</span>
      <span class="nx">hMask</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">topShader</span>
      <span class="nx">hMask</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">bottomShader</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>The bleed variable creates some overlap between the panels to prevent
cracks in the paper.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bleed = </span><span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>The panel element holds both its respective mask and all subsequent sibling panels.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hPanel = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;div&#39;</span>
    <span class="nv">hPanel.className = </span><span class="s">&#39;oridomi-panel-h&#39;</span>
    <span class="nv">hPanel.style.width = </span><span class="s">&#39;100%&#39;</span>
    <span class="nv">hPanel.style.height = </span><span class="nx">@panelHeight</span> <span class="o">+</span> <span class="nx">bleed</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
    <span class="nv">hPanel.style.padding = </span><span class="s">&#39;0&#39;</span>
    <span class="nv">hPanel.style.position = </span><span class="s">&#39;relative&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>The panel element is the target of the transforms.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionProp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transformProp</span>
    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionDuration</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">speed</span> <span class="o">+</span> <span class="s">&#39;ms&#39;</span>
    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transitionEasing</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">easingMethod</span>
    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">origin</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;top&#39;</span>
    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transformStyle</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;preserve-3d&#39;</span>
    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">backface</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;hidden&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Apply a transparent border to force edge smoothing on Firefox.
(This setting hurts performance significantly.)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">forceAntialiasing</span>
      <span class="nv">hPanel.style.outline = </span><span class="s">&#39;1px solid transparent&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Add the horizontal mask prototype to the horizontal panel prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hPanel</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">hMask</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Loop through just the horizontal anchors.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">anchor</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Loop through the number of horizontal panels.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@hPanels</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Clone a copy of the panel prototype for manipulation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">panel = </span><span class="nx">hPanel</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Set a reference to its inner content.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">content = </span><span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-content&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;top&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>The <code>yOffset</code> shifts the content of the panel down so they appear contiguous.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">yOffset = </span><span class="o">-</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">@panelHeight</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>This conditional pushes each panel's position down so they stack on top of each other.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="nv">panel.style.top = </span><span class="s">&#39;0&#39;</span>
          <span class="k">else</span>
            <span class="nv">panel.style.top = </span><span class="nx">@panelHeight</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>For bottom panels, make sure the transform origin is <code>'bottom'</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">panel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">origin</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;bottom&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>For the bottom <code>yOffset</code> and top position, we need to work backwards.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">yOffset = </span><span class="o">-</span><span class="p">((</span><span class="nx">@hPanels</span> <span class="o">*</span> <span class="nx">@panelHeight</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@panelHeight</span> <span class="o">*</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>

          <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="nv">panel.style.top = </span><span class="nx">@panelHeight</span> <span class="o">*</span> <span class="p">(</span><span class="nx">@vPanels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nx">bleed</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
          <span class="k">else</span>
            <span class="nv">panel.style.top = </span><span class="o">-</span><span class="nx">@panelHeight</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>

        <span class="nv">content.style.top = </span><span class="nx">yOffset</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Store references to the shader divs in the <code>shaders</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@shading</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">top</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-top&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">bottom</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-bottom&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Store a reference to this panel in the <code>panels</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">panel</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Append each panel to its previous sibling (unless it's the first panel).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">unless</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">appendChild</span> <span class="nx">panel</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Append the first panel (containing all of its siblings) to its respective stage.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">appendChild</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Now that the horizontal panels are done, we can clone the <code>hMask</code> for the vertical mask prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">vMask = </span><span class="nx">hMask</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span>
    <span class="nv">vMask.className = </span><span class="s">&#39;oridomi-mask-v&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Create left and right shaders if applicable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shading</span>
      <span class="nv">leftShader = </span><span class="nx">vMask</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-top&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">leftShader.className = </span><span class="s">&#39;oridomi-shader-left&#39;</span>
      <span class="nv">leftShader.style.background = </span><span class="nx">@_getShaderGradient</span> <span class="s">&#39;left&#39;</span>
      <span class="nv">rightShader = </span><span class="nx">vMask</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-bottom&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">rightShader.className = </span><span class="s">&#39;oridomi-shader-right&#39;</span>
      <span class="nv">rightShader.style.background = </span><span class="nx">@_getShaderGradient</span> <span class="s">&#39;right&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Clone the <code>hPanel</code> prototype and adjust its styling for vertical use.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">vPanel = </span><span class="nx">hPanel</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">false</span>
    <span class="nv">vPanel.className = </span><span class="s">&#39;oridomi-panel-v&#39;</span>
    <span class="nv">vPanel.style.width = </span><span class="nx">@panelWidth</span> <span class="o">+</span> <span class="nx">bleed</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
    <span class="nv">vPanel.style.height = </span><span class="s">&#39;100%&#39;</span>
    <span class="nx">vPanel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">origin</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;left&#39;</span>
    <span class="nx">vPanel</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">vMask</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Repeat a similar panel creation process for vertical panels.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">anchor</span> <span class="k">in</span> <span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;right&#39;</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@vPanels</span><span class="p">]</span>
        <span class="nv">panel = </span><span class="nx">vPanel</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span>
        <span class="nv">content = </span><span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-content&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;left&#39;</span>
          <span class="nv">xOffset = </span><span class="o">-</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">@panelWidth</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="nv">panel.style.left = </span><span class="s">&#39;0&#39;</span>
          <span class="k">else</span>
            <span class="nv">panel.style.left = </span><span class="nx">@panelWidth</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
        <span class="k">else</span>
          <span class="nx">panel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">origin</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;right&#39;</span>
          <span class="nv">xOffset = </span><span class="o">-</span><span class="p">((</span><span class="nx">@vPanels</span> <span class="o">*</span> <span class="nx">@panelWidth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">@panelWidth</span> <span class="o">*</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
          <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
            <span class="nv">panel.style.left = </span><span class="nx">@panelWidth</span> <span class="o">*</span> <span class="p">(</span><span class="nx">@vPanels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
          <span class="k">else</span>
            <span class="nv">panel.style.left = </span><span class="o">-</span><span class="nx">@panelWidth</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>

        <span class="nv">content.style.left = </span><span class="nx">xOffset</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>

        <span class="k">if</span> <span class="nx">@shading</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">left</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>  <span class="o">=</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-left&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">right</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s">&#39;oridomi-shader-right&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">panel</span>

        <span class="nx">unless</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">appendChild</span> <span class="nx">panel</span>

      <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">appendChild</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Add a special class to the target element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">oriDomiClass</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Remove its padding and set a fixed width and height.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@el.style.padding = </span><span class="s">&#39;0&#39;</span>
    <span class="vi">@el.style.width = </span><span class="nx">@width</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span>
    <span class="vi">@el.style.height = </span><span class="nx">@height</span> <span class="o">+</span> <span class="s">&#39;px&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Remove its background, border, and outline.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@el.style.backgroundColor = </span><span class="s">&#39;transparent&#39;</span>
    <span class="vi">@el.style.backgroundImage = </span><span class="s">&#39;none&#39;</span>
    <span class="vi">@el.style.border = </span><span class="s">&#39;none&#39;</span>
    <span class="vi">@el.style.outline = </span><span class="s">&#39;none&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Show the left stage to start with.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@stages.left.style.display = </span><span class="s">&#39;block&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Empty the target element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@el.innerHTML = </span><span class="s">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Append each stage to the target element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">anchor</span> <span class="k">in</span> <span class="nx">@anchors</span>
      <span class="nx">@el</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Show the target if applicable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@settings</span><span class="p">.</span><span class="nx">showOnStart</span>
      <span class="vi">@el.style.display = </span><span class="s">&#39;block&#39;</span>
      <span class="vi">@el.style.visibility = </span><span class="s">&#39;visible&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Cache a jQuery object of the element if applicable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@$el = </span><span class="nx">$</span> <span class="nx">@el</span> <span class="k">if</span> <span class="nx">$</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>If a callback was passed in the constructor options, run it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_callback</span> <span class="nx">@settings</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>End the constructor benchmark if <code>devMode</code> is active.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span> <span class="s">&#39;oridomiConstruction&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <h1>Internal Methods</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p><code>_callback</code> normalizes callback handling for all public methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_callback: </span><span class="nf">(options) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Create a local callback for the animation's end.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">onTransitionEnd = </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Remove the event listener immediately to prevent bubbling.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">removeEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Invoke the callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>If there was no transformation (0 degrees) invoke the callback immediately.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@lastAngle</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Otherwise, attach an event listener to be called on the transition's end.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">else</span>
        <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">addEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p><code>_transform</code> returns a <code>rotate3d</code> transform string based on the anchor and angle.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_transform: </span><span class="nf">(angle, fracture) -&gt;</span>
    <span class="k">switch</span> <span class="nx">@lastAnchor</span>
      <span class="k">when</span> <span class="s">&#39;left&#39;</span>
        <span class="nv">axes = </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">angle</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&#39;right&#39;</span>
        <span class="nv">axes = </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">angle</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&#39;top&#39;</span>
        <span class="nv">axes = </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">angle</span><span class="p">]</span>
      <span class="k">when</span> <span class="s">&#39;bottom&#39;</span>
        <span class="nv">axes = </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">angle</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p><code>fracture</code> is a special option that splits up the panels by rotating them on all axes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">fracture</span>
      <span class="p">[</span><span class="nx">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="s">&quot;rotate3d(</span><span class="si">#{</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="si">}</span><span class="s">, </span><span class="si">#{</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="si">}</span><span class="s">, </span><span class="si">#{</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="si">}</span><span class="s">, </span><span class="si">#{</span> <span class="nx">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="si">}</span><span class="s">deg)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p><code>_normalizeAngle</code> validates a given angle by making sure it's a float and by
keeping it within a range of -89/89 degrees. Fully 90 degree angles tend to look glitchy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_normalizeAngle: </span><span class="nf">(angle) -&gt;</span>
    <span class="nv">angle = </span><span class="nb">parseFloat</span> <span class="nx">angle</span><span class="p">,</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="nb">isNaN</span> <span class="nx">angle</span>
      <span class="mi">0</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">angle</span> <span class="o">&gt;</span> <span class="mi">89</span>
      <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&#39;oriDomi: Maximum value is 89&#39;</span>
      <span class="mi">89</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">89</span>
      <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&#39;oriDomi: Minimum value is -89&#39;</span>
      <span class="o">-</span><span class="mi">89</span>
    <span class="k">else</span>
      <span class="nx">angle</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p><code>_normalizeArgs</code> bootstraps every public method.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_normalizeArgs: </span><span class="nf">(method, args) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Get a valid angle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">angle = </span><span class="nx">@_normalizeAngle</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Get the full anchor name.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">anchor = </span><span class="nx">@_getLonghandAnchor</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Extend the given options with the method's defaults.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">options = </span><span class="nx">extendObj</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">@_methodDefaults</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>If the user is trying to transform using a different anchor, we must first
unfold the current anchor for transition purposes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">anchor</span> <span class="o">isnt</span> <span class="nx">@lastAnchor</span> <span class="o">or</span> <span class="p">(</span><span class="nx">method</span> <span class="o">is</span> <span class="s">&#39;foldUp&#39;</span> <span class="o">and</span> <span class="nx">@lastAngle</span> <span class="o">isnt</span> <span class="mi">0</span><span class="p">)</span> <span class="o">or</span> <span class="nx">@isFoldedUp</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>Call <code>reset</code> and pass a callback to be run when the unfolding is complete.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@reset</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Show the stage element of the originally requested anchor.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@_showStage</span> <span class="nx">anchor</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Defer this operation until the next event loop to prevent a sudden jump.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setTimeout</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p><code>foldUp</code> is a special method that doesn't accept an angle argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="nx">method</span> <span class="o">is</span> <span class="s">&#39;foldUp&#39;</span>
            <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>We can now call the originally requested method.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">@</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">args</span>

        <span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Return <code>false</code> here to inform the caller method to abort its operation
and wait to be called when the stage is ready.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kc">false</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>Set an instance reference to the last called angle and return the normalized arguments.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@lastAngle = </span><span class="nx">angle</span>
      <span class="p">[</span><span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p><code>_setShader</code> determines a shader's opacity based upon panel position, anchor, and angle.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_setShader: </span><span class="nf">(i, anchor, angle) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>Store the angle's absolute value and generate an opacity based on <code>shadingIntensity</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">abs = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">angle</span>
    <span class="nv">opacity = </span><span class="nx">abs</span> <span class="o">/</span> <span class="mi">90</span> <span class="o">*</span> <span class="nx">@shadingIntensity</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>With hard shading, opacity is reduced and <code>angle</code> is based on the global
<code>lastAngle</code> so all panels' shaders share the same direction. Soft shaders
have alternating directions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@shading</span> <span class="o">is</span> <span class="s">&#39;hard&#39;</span>
      <span class="nx">opacity</span> <span class="o">*=</span> <span class="p">.</span><span class="mi">15</span>
      <span class="k">if</span> <span class="nx">@lastAngle</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="nv">angle = </span><span class="nx">abs</span>
      <span class="k">else</span>
        <span class="nv">angle = </span><span class="o">-</span><span class="nx">abs</span>
    <span class="k">else</span>
      <span class="nx">opacity</span> <span class="o">*=</span> <span class="p">.</span><span class="mi">4</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>This block makes sure left and top shaders appear for negative angles and right
and bottom shaders appear for positive ones.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">switch</span> <span class="nx">anchor</span>
      <span class="k">when</span> <span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;top&#39;</span>
        <span class="k">if</span> <span class="nx">angle</span> <span class="o">&lt;</span> <span class="mi">0</span>
          <span class="nv">a = </span><span class="nx">opacity</span>
          <span class="nv">b = </span><span class="mi">0</span>
        <span class="k">else</span>
          <span class="nv">a = </span><span class="mi">0</span>
          <span class="nv">b = </span><span class="nx">opacity</span>
      <span class="k">when</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span>
        <span class="k">if</span> <span class="nx">angle</span> <span class="o">&lt;</span> <span class="mi">0</span>
          <span class="nv">a = </span><span class="mi">0</span>
          <span class="nv">b = </span><span class="nx">opacity</span>
        <span class="k">else</span>
          <span class="nv">a = </span><span class="nx">opacity</span>
          <span class="nv">b = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Only manipulate shader opacity for the current axis.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;left&#39;</span> <span class="o">or</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;right&#39;</span>
      <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">left</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.opacity = </span><span class="nx">a</span>
      <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">right</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.opacity = </span><span class="nx">b</span>
    <span class="k">else</span>
      <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">top</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.opacity = </span><span class="nx">a</span>
      <span class="nx">@shaders</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">bottom</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.opacity = </span><span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>This is a simple method used by the constructor to set CSS gradient styles.
It accepts an anchor argument to start the gradient slope.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_getShaderGradient: </span><span class="nf">(anchor) -&gt;</span>
    <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">css</span><span class="p">.</span><span class="nx">gradientProp</span> <span class="si">}</span><span class="s">(</span><span class="si">#{</span> <span class="nx">anchor</span> <span class="si">}</span><span class="s">, rgba(0, 0, 0, .5) 0%, rgba(255, 255, 255, .35) 100%)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>This method shows the requested stage element and sets a reference to it as
the current stage.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_showStage: </span><span class="nf">(anchor) -&gt;</span>
    <span class="nx">@stages</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nv">style.display = </span><span class="s">&#39;block&#39;</span>
    <span class="nx">@stages</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">].</span><span class="nv">style.display = </span><span class="s">&#39;none&#39;</span>
    <span class="vi">@lastAnchor = </span><span class="nx">anchor</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Simple method that returns the correct panel set based on an anchor.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_getPanelType: </span><span class="nf">(anchor) -&gt;</span>
    <span class="k">if</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;left&#39;</span> <span class="o">or</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;right&#39;</span>
      <span class="nx">@vPanels</span>
    <span class="k">else</span>
      <span class="nx">@hPanels</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Converts a shorthand anchor name to a full one.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_getLonghandAnchor: </span><span class="nf">(shorthand) -&gt;</span>
    <span class="k">switch</span> <span class="nx">shorthand</span>
      <span class="k">when</span> <span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="mi">4</span>
        <span class="s">&#39;left&#39;</span>
      <span class="k">when</span> <span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="mi">2</span>
        <span class="s">&#39;right&#39;</span>
      <span class="k">when</span> <span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="mi">1</span>
        <span class="s">&#39;top&#39;</span>
      <span class="k">when</span> <span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="mi">3</span>
        <span class="s">&#39;bottom&#39;</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Left is always default.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="s">&#39;left&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Map of defaults for each method. Some are empty for now.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_methodDefaults:</span>
    <span class="nv">accordion:</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Sticky keeps the first panel flat on the page.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">sticky: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Stairs creates a stairway effect.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">stairs: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>Twist and fracture are similar effects that result in wild non-origami-like splits.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">fracture: </span><span class="kc">false</span>
      <span class="nv">twist: </span><span class="kc">false</span>
    <span class="nv">curl:</span>
      <span class="nv">twist: </span><span class="kc">false</span>
    <span class="nv">ramp: </span><span class="p">{}</span>
    <span class="nv">foldUp: </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <h1>Public Methods</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>Reset handles resetting all panels back to zero degrees.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reset: </span><span class="nf">(callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>If the stage is folded up, unfold it first.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@isFoldedUp</span>
      <span class="k">return</span> <span class="nx">@unfold</span> <span class="nx">callback</span>

    <span class="k">for</span> <span class="nx">panel</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">]</span>
      <span class="nx">panel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="nx">@shading</span>
        <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">@lastAnchor</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>When called internally, <code>reset</code> comes with a callback to advance to the next transformation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_callback</span> <span class="nv">callback: </span><span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>oriDomi's bread and butter effect. Transforms the target like its namesake.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">accordion: </span><span class="nf">(angle, anchor, options) -&gt;</span>
    <span class="nv">normalized = </span><span class="nx">@_normalizeArgs</span> <span class="s">&#39;accordion&#39;</span><span class="p">,</span> <span class="nx">arguments</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>If <code>_normalizeArgs</code> returns false, we need to abort for a reset operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">normalized</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Otherwise, destructure the normalized arguments into some local variables.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span><span class="p">]</span> <span class="o">=</span> <span class="nx">normalized</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Loop through the panels in this stage.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">panel</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>If it's an odd-numbered panel, reverse the angle.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">isnt</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">twist</span>
        <span class="nv">deg = </span><span class="o">-</span><span class="nx">angle</span>
      <span class="k">else</span>
        <span class="nv">deg = </span><span class="nx">angle</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>If sticky, keep the first panel flat.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sticky</span>
        <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
          <span class="nv">deg = </span><span class="mi">0</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">or</span> <span class="nx">options</span><span class="p">.</span><span class="nx">stairs</span>
          <span class="nx">deg</span> <span class="o">*=</span> <span class="mi">2</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>Double the angle to counteract the angle of the parent panel.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">deg</span> <span class="o">*=</span> <span class="mi">2</span> <span class="nx">unless</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>In stairs mode, keep all the angles on the same side of 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">stairs</span>
        <span class="nv">deg = </span><span class="o">-</span><span class="nx">deg</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>Set the CSS transformation.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">panel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="nx">deg</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">fracture</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Apply shaders.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">@shading</span> <span class="o">and</span> <span class="o">!</span><span class="p">(</span><span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sticky</span><span class="p">)</span> <span class="o">and</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">deg</span><span class="p">)</span> <span class="o">isnt</span> <span class="mi">180</span>
        <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">deg</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>Ask <code>_callback</code> to check for a callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_callback</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p><code>curl</code> appears to bend rather than fold the paper. Its curves can appear smoother
with higher panel counts.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">curl: </span><span class="nf">(angle, anchor, options) -&gt;</span>
    <span class="nv">normalized = </span><span class="nx">@_normalizeArgs</span> <span class="s">&#39;curl&#39;</span><span class="p">,</span> <span class="nx">arguments</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">normalized</span>
    <span class="p">[</span><span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span><span class="p">]</span> <span class="o">=</span> <span class="nx">normalized</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>Reduce the angle based on the number of panels in this axis.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">angle</span> <span class="o">/=</span>  <span class="nx">@_getPanelType</span> <span class="nx">anchor</span>

    <span class="k">for</span> <span class="nx">panel</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span>
      <span class="nx">panel</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="nx">angle</span>

      <span class="k">if</span> <span class="nx">@shading</span>
        <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="mi">0</span>

    <span class="nx">@_callback</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p><code>ramp</code> lifts up all panels after the first one.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ramp: </span><span class="nf">(angle, anchor, options) -&gt;</span>
    <span class="nv">normalized = </span><span class="nx">@_normalizeArgs</span> <span class="s">&#39;ramp&#39;</span><span class="p">,</span> <span class="nx">arguments</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">normalized</span>
    <span class="p">[</span><span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span><span class="p">]</span> <span class="o">=</span> <span class="nx">normalized</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>Rotate the second panel for the lift up.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="nx">angle</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>For all but the first two panels, set the angle to 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">panel</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="mi">0</span>

      <span class="k">if</span> <span class="nx">@shading</span>
        <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="mi">0</span>

    <span class="nx">@_callback</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p><code>foldUp</code> folds up all panels in separate synchronous animations.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">foldUp: </span><span class="nf">(anchor, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Default to left anchor.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">anchor</span>
      <span class="nv">anchor = </span><span class="s">&#39;left&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>Check if callback is the first argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">anchor</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
      <span class="nv">callback = </span><span class="nx">anchor</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p><code>foldUp</code> uses irregular arguments, so we manually construct the arugments array.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">normalized = </span><span class="nx">@_normalizeArgs</span> <span class="s">&#39;foldUp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="p">{}]</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">normalized</span>
    <span class="nv">anchor = </span><span class="nx">normalized</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>Set <code>isFoldedUp</code> to <code>true</code> so we are forced to unfold before calling other methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isFoldedUp = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>Start an iterator at the last panel in this anchor.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">i = </span><span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Rotate 100 degrees.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">angle = </span><span class="mi">100</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>Local function that sets an event listener on the current panel and transforms it.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">nextPanel = </span><span class="o">=&gt;</span>
      <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span>
      <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="nx">angle</span>
      <span class="k">if</span> <span class="nx">@shading</span>
        <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">angle</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Called when each panel finishes folding in.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">onTransitionEnd = </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>Remove the listener.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">removeEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Hide the panel so it doesn't collide when bending around.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@panels</span><span class="p">[</span><span class="nx">anchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.display = </span><span class="s">&#39;none&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>Decrement the iterator and check if we're on the first panel.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="o">--</span><span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>If so, invoke the callback directly if applicable.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">callback</span><span class="p">()</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>Otherwise, defer until the next event loop and fold back the next panel.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setTimeout</span> <span class="nx">nextPanel</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>Start the chain of folds.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">nextPanel</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>Essentially the inverse of <code>foldUp</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">unfold: </span><span class="nf">(callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>If the target isn't folded up, there's no reason to call this method and
the callback is immediately invoked.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">@isFoldedUp</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
        <span class="nx">callback</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>Reset <code>isFoldedUp</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@isFoldedUp = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>Start the iterator on the second panel.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">i = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>Rotate back to 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">angle = </span><span class="mi">0</span>

    <span class="nv">nextPanel = </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>Show the panel again.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nv">style.display = </span><span class="s">&#39;block&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>Wait for the next event loop so the transition listener works.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">setTimeout</span> <span class="o">=&gt;</span>
        <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">addEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span>
        <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="nx">css</span><span class="p">.</span><span class="nx">transform</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_transform</span> <span class="nx">angle</span>
        <span class="k">if</span> <span class="nx">@shading</span>
          <span class="nx">@_setShader</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">@lastAnchor</span><span class="p">,</span> <span class="nx">angle</span>
      <span class="p">,</span> <span class="mi">0</span>
    
    <span class="nv">onTransitionEnd = </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">removeEventListener</span> <span class="nx">css</span><span class="p">.</span><span class="nx">transitionEnd</span><span class="p">,</span> <span class="nx">onTransitionEnd</span><span class="p">,</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>Increment the iterator and check if we're past the last panel.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="o">++</span><span class="nx">i</span> <span class="o">is</span> <span class="nx">@panels</span><span class="p">[</span><span class="nx">@lastAnchor</span><span class="p">].</span><span class="nx">length</span>
        <span class="nx">callback</span><span class="p">()</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
      <span class="k">else</span>
        <span class="nx">setTimeout</span> <span class="nx">nextPanel</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>Start the sequence.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">nextPanel</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <h1>Convenience Methods</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>Completely folds in target.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collapse: </span><span class="nf">(anchor, options = {}) -&gt;</span>
    <span class="nv">options.sticky = </span><span class="kc">false</span>
    <span class="nx">@accordion</span> <span class="o">-</span><span class="mi">89</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>Same as <code>collapse</code>, but uses negative angle for slightly different effect.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collapseAlt: </span><span class="nf">(anchor, options = {}) -&gt;</span>
    <span class="nv">options.sticky = </span><span class="kc">false</span>
    <span class="nx">@accordion</span> <span class="mi">89</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>Simply proxy for calling <code>accordion</code> with <code>sticky</code> enabled.
Keeps first panel flat on page.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reveal: </span><span class="nf">(angle, anchor, options = {}) -&gt;</span>
    <span class="nv">options.sticky = </span><span class="kc">true</span>
    <span class="nx">@accordion</span> <span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>Proxy to enable stairs mode on <code>accordion</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">stairs: </span><span class="nf">(angle, anchor, options = {}) -&gt;</span>
    <span class="nv">options.stairs = </span><span class="kc">true</span>
    <span class="nv">options.sticky = </span><span class="kc">true</span>
    <span class="nx">@accordion</span> <span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p><code>fracture: true</code> proxy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fracture: </span><span class="nf">(angle, anchor, options = {}) -&gt;</span>
    <span class="nv">options.fracture = </span><span class="kc">true</span>
    <span class="nx">@accordion</span> <span class="nx">angle</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p><code>twist: true</code> proxy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">twist: </span><span class="nf">(angle, anchor, options = {}) -&gt;</span>
    <span class="nv">options.fracture = </span><span class="kc">true</span>
    <span class="nv">options.twist = </span><span class="kc">true</span>
    <span class="nx">@accordion</span> <span class="nx">angle</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">anchor</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>Set a version flag for easy external retrieval.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">OriDomi.VERSION = </span><span class="s">&#39;0.1.0&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>External function to enable <code>devMode</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">OriDomi.devMode = </span><span class="o">-&gt;</span>
  <span class="nv">devMode = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>Attach <code>OriDomi</code> constructor to <code>window</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root.OriDomi = </span><span class="nx">OriDomi</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <h1>Plugin Bridge</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>Only create bridge if jQuery (or the like) exists.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nx">$</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>Attach an <code>oriDomi</code> method to <code>$</code>'s prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">$.fn.oriDomi = </span><span class="nf">(options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>Return selection if oriDomi is unsupported by the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">@</span> <span class="nx">unless</span> <span class="nx">oriDomiSupport</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>If <code>options</code> is a string, assume it's a method call.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>Check if method exists and warn if it doesn't.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">unless</span> <span class="k">typeof</span> <span class="nx">OriDomi</span><span class="o">::</span><span class="p">[</span><span class="nx">options</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
        <span class="k">return</span> <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&quot;oriDomi: No such method &#39;</span><span class="si">#{</span> <span class="nx">options</span> <span class="si">}</span><span class="s">&#39;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>Loop through selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>Retrieve the instance of oriDomi attached to the element.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">instance = </span><span class="nx">$</span><span class="p">.</span><span class="nx">data</span> <span class="nx">el</span><span class="p">,</span> <span class="s">&#39;oriDomi&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>Warn if oriDomi hasn't been initialized on this element.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">unless</span> <span class="nx">instance</span><span class="o">?</span>
          <span class="k">return</span> <span class="nx">devMode</span> <span class="o">and</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&quot;oriDomi: Can&#39;t call </span><span class="si">#{</span> <span class="nx">options</span> <span class="si">}</span><span class="s">, oriDomi hasn&#39;t been initialized on this element&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>Convert arguments to a proper array and remove the first element.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">args = </span><span class="nb">Array</span><span class="o">::</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span> <span class="nx">arguments</span>
        <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>Call method from instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">instance</span><span class="p">[</span><span class="nx">options</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">args</span></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>Return selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>If not calling a method, initialize oriDomi on the selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span>
      <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>If the element in the selection already has an instance of oriDomi
attached to it, return the instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">instance = </span><span class="nx">$</span><span class="p">.</span><span class="nx">data</span> <span class="nx">el</span><span class="p">,</span> <span class="s">&#39;oriDomi&#39;</span>
        <span class="k">if</span> <span class="nx">instance</span>
          <span class="k">return</span> <span class="nx">instance</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>Create an instance of oriDomi and attach it to the element.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">$</span><span class="p">.</span><span class="nx">data</span> <span class="nx">el</span><span class="p">,</span> <span class="s">&#39;oriDomi&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">OriDomi</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>Return the selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
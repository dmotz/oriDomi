<!DOCTYPE html>

<html>
<head>
  <title>OriDomi</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="oridomi">OriDomi</h1>
<h3 id="fold-up-the-dom-like-paper-">Fold up the DOM like paper.</h3>
<p>1.1.5</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><a href="https://oxism.com/oriDomi">Demos / docs</a></p>
<h4 id="by-dan-motzenbecker-http-oxism-com-">by <a href="https://oxism.com">Dan Motzenbecker</a></h4>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Copyright 2014, MIT License</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

libName = <span class="hljs-string">'OriDomi'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>This variable is set to true and negated later if the browser does
not support OriDomi.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>isSupported = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h1 id="utility-functions">Utility Functions</h1>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Used for informing the developer which required feature the browser lacks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">supportWarning</span> = <span class="hljs-params">(prop)</span> -&gt;</span>
  <span class="hljs-built_in">console</span>?.warn <span class="hljs-string">"<span class="hljs-subst">#{ libName }</span>: Missing support for `<span class="hljs-subst">#{ prop }</span>`."</span>
  isSupported = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Checks for the presence of CSS properties on a test element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">testProp</span> = <span class="hljs-params">(prop)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Loop through the vendor prefix list and return a match is found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> prefixList
    <span class="hljs-keyword">return</span> full <span class="hljs-keyword">if</span> (full = prefix + capitalize prop) <span class="hljs-keyword">of</span> testEl.style</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the unprefixed property is present, return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> prop <span class="hljs-keyword">if</span> prop <span class="hljs-keyword">of</span> testEl.style</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>If no matches are found, return false to denote that the browser is
missing this property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Generates CSS text based on a selector string and a map of styling rules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">addStyle</span> = <span class="hljs-params">(selector, rules)</span> -&gt;</span>
  style = <span class="hljs-string">".<span class="hljs-subst">#{ selector }</span>{"</span>
  <span class="hljs-keyword">for</span> prop, val <span class="hljs-keyword">of</span> rules</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If the CSS property is among special properties defined later, prefix it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> prop <span class="hljs-keyword">of</span> css
      prop = css[prop]
      prop = <span class="hljs-string">'-'</span> + prop <span class="hljs-keyword">if</span> prop.match <span class="hljs-regexp">/^(webkit|moz|ms)/i</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Convert camel case to hyphenated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    style += <span class="hljs-string">"<span class="hljs-subst">#{ prop.replace(<span class="hljs-regexp">/([a-z])([A-Z])/g</span>, <span class="hljs-string">'$1-$2'</span>).toLowerCase() }</span>:<span class="hljs-subst">#{ val }</span>;"</span>

  styleBuffer += style + <span class="hljs-string">'}'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Defines gradient directions based on a given anchor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">getGradient</span> = <span class="hljs-params">(anchor)</span> -&gt;</span>
  <span class="hljs-string">"<span class="hljs-subst">#{ css.gradientProp }</span>(<span class="hljs-subst">#{ anchor }</span>, rgba(0, 0, 0, .5) 0%, rgba(255, 255, 255, .35) 100%)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Used mainly when creating camel cased strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">capitalize</span> = <span class="hljs-params">(s)</span> -&gt;</span>
  s[<span class="hljs-number">0</span>].toUpperCase() + s[<span class="hljs-number">1.</span>..]</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create an element and look up the canonical class name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">createEl</span> = <span class="hljs-params">(className)</span> -&gt;</span>
  el = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
  el.className = elClasses[className]
  el</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Clone an element, add an additional class, and return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">cloneEl</span> = <span class="hljs-params">(parent, deep, className)</span> -&gt;</span>
  el = parent.cloneNode deep
  el.classList.add elClasses[className]
  el</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>GPU efficient ways of hiding and showing elements:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">hideEl</span> = <span class="hljs-params">(el)</span> -&gt;</span>
  el.style[css.transform] = <span class="hljs-string">'translate3d(-99999px, 0, 0)'</span>
<span class="hljs-function">

<span class="hljs-title">showEl</span> = <span class="hljs-params">(el)</span> -&gt;</span>
  el.style[css.transform] = <span class="hljs-string">'translate3d(0, 0, 0)'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>This decorator is used on public effect methods to invoke preliminary tasks
before the effect is applied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">prep</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If the method has been initiated by a touch handler, skip this process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @_touchStarted
      fn.apply @, arguments
    <span class="hljs-keyword">else</span>
      [a0, a1, a2] = arguments
      opt          = {}
      angle        = anchor = <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>This switch is used to derive the intended order of arguments.
This keeps argument requirements flexible, allowing most to be left out.
By putting this logic in a decorator, it doesn’t have to exist in any
of the individual methods.</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Methods are inferred by their arity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">switch</span> fn.length
        <span class="hljs-keyword">when</span> <span class="hljs-number">1</span>
          opt.callback = a0
        <span class="hljs-keyword">when</span> <span class="hljs-number">2</span>
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a0 <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
            opt.callback = a0
          <span class="hljs-keyword">else</span>
            anchor       = a0
            opt.callback = a1
        <span class="hljs-keyword">when</span> <span class="hljs-number">3</span>
          angle = a0
          <span class="hljs-keyword">if</span> arguments.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a1 <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
              opt = a1
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a1 <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
              opt.callback = a1
            <span class="hljs-keyword">else</span>
              anchor = a1
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> arguments.length <span class="hljs-keyword">is</span> <span class="hljs-number">3</span>
            anchor = a1
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a2 <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
              opt = a2
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> a2 <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
              opt.callback = a2

      angle   ?= @_lastOp.angle <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
      anchor <span class="hljs-keyword">or</span>= @_lastOp.anchor</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Here we add the called function and its normalized arguments to the
instance’s queue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_queue.push [fn, @_normalizeAngle(angle), @_getLonghandAnchor(anchor), opt]</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>_step()</code> manages the queue and decides whether the action will occur now
or be deferred.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_step()</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>This decorator also returns the instance so effect methods are chainable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>It’s necessary to defer many DOM manipulations to a subsequent event loop tick.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">defer</span> = <span class="hljs-params">(fn)</span> -&gt;</span>
  setTimeout fn, <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Empty function to be used as placeholder for callback defaults
(instead of creating separate empty functions).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">noOp</span> = -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h1 id="setup">Setup</h1>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Set a reference to jQuery (or another <code>$</code>-aliased DOM library).
If it doesn’t exist, set to null so OriDomi knows we are working without jQuery.
OriDomi doesn’t require it to work, but offers a useful plugin bridge if present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ = <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>?.$?.data <span class="hljs-keyword">then</span> <span class="hljs-built_in">window</span>.$ <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>List of anchors and their corresponding axis pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>anchorList  = [<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>, <span class="hljs-string">'top'</span>, <span class="hljs-string">'bottom'</span>]
anchorListV = anchorList[.<span class="hljs-number">.1</span>]
anchorListH = anchorList[<span class="hljs-number">2.</span>.]</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Create a div for testing CSS3 properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>testEl = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>The style buffer is later populated with CSS rules and appended to the document.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>styleBuffer = <span class="hljs-string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>List of browser prefixes for testing CSS3 properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>prefixList = [<span class="hljs-string">'Webkit'</span>, <span class="hljs-string">'Moz'</span>, <span class="hljs-string">'ms'</span>]
baseName   = libName.toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>CSS classes used by style rules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>elClasses  =
  active:       <span class="hljs-string">'active'</span>
  clone:        <span class="hljs-string">'clone'</span>
  holder:       <span class="hljs-string">'holder'</span>
  stage:        <span class="hljs-string">'stage'</span>
  stageLeft:    <span class="hljs-string">'stage-left'</span>
  stageRight:   <span class="hljs-string">'stage-right'</span>
  stageTop:     <span class="hljs-string">'stage-top'</span>
  stageBottom:  <span class="hljs-string">'stage-bottom'</span>
  content:      <span class="hljs-string">'content'</span>
  mask:         <span class="hljs-string">'mask'</span>
  maskH:        <span class="hljs-string">'mask-h'</span>
  maskV:        <span class="hljs-string">'mask-v'</span>
  panel:        <span class="hljs-string">'panel'</span>
  panelH:       <span class="hljs-string">'panel-h'</span>
  panelV:       <span class="hljs-string">'panel-v'</span>
  shader:       <span class="hljs-string">'shader'</span>
  shaderLeft:   <span class="hljs-string">'shader-left'</span>
  shaderRight:  <span class="hljs-string">'shader-right'</span>
  shaderTop:    <span class="hljs-string">'shader-top'</span>
  shaderBottom: <span class="hljs-string">'shader-bottom'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Each class is namespaced to prevent styling collisions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>elClasses[k] = <span class="hljs-string">"<span class="hljs-subst">#{ baseName }</span>-<span class="hljs-subst">#{ v }</span>"</span> <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> elClasses</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Map of the CSS3 properties needed to support OriDomi, with shorthand names as keys.
The keys and values are initialized as identical pairs to start with and prefixed
subsequently when necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>css = <span class="hljs-keyword">new</span> -&gt;
  @[key] = key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> [
    <span class="hljs-string">'transform'</span>
    <span class="hljs-string">'transformOrigin'</span>
    <span class="hljs-string">'transformStyle'</span>
    <span class="hljs-string">'transitionProperty'</span>
    <span class="hljs-string">'transitionDuration'</span>
    <span class="hljs-string">'transitionDelay'</span>
    <span class="hljs-string">'transitionTimingFunction'</span>
    <span class="hljs-string">'perspective'</span>
    <span class="hljs-string">'perspectiveOrigin'</span>
    <span class="hljs-string">'backfaceVisibility'</span>
    <span class="hljs-string">'boxSizing'</span>
    <span class="hljs-string">'mask'</span>
  ]
  @</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>This section is wrapped in a function call so that it can exit
early when discovering a lack of browser support to prevent unnecessary work.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">do</span> -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Loop through the CSS map and replace each value with the result of <code>testProp()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> css
    css[key] = testProp value</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>If the returned value is false, warn the user that the browser doesn’t support
OriDomi, set <code>isSupported</code> to false, and break out of the loop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> supportWarning value <span class="hljs-keyword">unless</span> css[key]</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Test for <code>preserve-3d</code> as a transform style. This is particularly important
since it’s necessary for nested 3D transforms and recent versions of IE that
support 3D transforms lack it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  p3d = <span class="hljs-string">'preserve-3d'</span>
  testEl.style[css.transformStyle] = p3d</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Failure is indicated when querying the style lacks the correct string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">unless</span> testEl.style[css.transformStyle] <span class="hljs-keyword">is</span> p3d
    <span class="hljs-keyword">return</span> supportWarning p3d</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>CSS3 linear gradients are used for shading.
Testing for them is different because they are prefixed values, not properties.
This invokes an anonymous function to loop through vendor-prefixed linear gradients.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  css.gradientProp = <span class="hljs-keyword">do</span> -&gt;
    <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> prefixList
      hyphenated = <span class="hljs-string">"-<span class="hljs-subst">#{ prefix.toLowerCase() }</span>-linear-gradient"</span>
      testEl.style.backgroundImage = <span class="hljs-string">"<span class="hljs-subst">#{ hyphenated }</span>(left, #000, #fff)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>After setting a gradient background on the test div, attempt to retrieve it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> hyphenated <span class="hljs-keyword">unless</span> testEl.style.backgroundImage.indexOf(<span class="hljs-string">'gradient'</span>) <span class="hljs-keyword">is</span> <span class="hljs-number">-1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>If none of the hyphenated values worked, return the unprefixed version.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'linear-gradient'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>The default cursor style is set to <code>grab</code> to prompt the user to interact with the element.
<code>grab</code> as a value isn’t supported in all browsers so it has to be detected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  [css.grab, css.grabbing] = <span class="hljs-keyword">do</span> -&gt;
    <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> prefixList
      plainGrab = <span class="hljs-string">'grab'</span>
      testEl.style.cursor = (grabValue = <span class="hljs-string">"-<span class="hljs-subst">#{ prefix.toLowerCase() }</span>-<span class="hljs-subst">#{ plainGrab }</span>"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>If the cursor was set correctly, return the prefixed pair.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> [grabValue, <span class="hljs-string">"-<span class="hljs-subst">#{ prefix.toLowerCase() }</span>-grabbing"</span>] <span class="hljs-keyword">if</span> testEl.style.cursor <span class="hljs-keyword">is</span> grabValue</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Otherwise try the unprefixed version.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    testEl.style.cursor = plainGrab
    <span class="hljs-keyword">if</span> testEl.style.cursor <span class="hljs-keyword">is</span> plainGrab
      [plainGrab, <span class="hljs-string">'grabbing'</span>]
    <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Fallback to <code>move</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      [<span class="hljs-string">'move'</span>, <span class="hljs-string">'move'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Like gradients, transform (as a transition value) needs to be detected and prefixed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  css.transformProp =</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Use a regular expression to pluck the prefix <code>testProp</code> found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> prefix = css.transform.match <span class="hljs-regexp">/(\w+)Transform/i</span>
      <span class="hljs-string">"-<span class="hljs-subst">#{ prefix[<span class="hljs-number">1</span>].toLowerCase() }</span>-transform"</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-string">'transform'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Set a <code>transitionEnd</code> property based on the browser’s prefix for <code>transitionProperty</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  css.transitionEnd =
    <span class="hljs-keyword">switch</span> css.transitionProperty.toLowerCase()
      <span class="hljs-keyword">when</span> <span class="hljs-string">'transitionproperty'</span>       <span class="hljs-keyword">then</span> <span class="hljs-string">'transitionEnd'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'webkittransitionproperty'</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'webkitTransitionEnd'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'moztransitionproperty'</span>    <span class="hljs-keyword">then</span> <span class="hljs-string">'transitionend'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'mstransitionproperty'</span>     <span class="hljs-keyword">then</span> <span class="hljs-string">'msTransitionEnd'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>These calls generate OriDomi’s stylesheet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">do</span> (i = <span class="hljs-function"><span class="hljs-params">(s)</span> -&gt;</span> s + <span class="hljs-string">' !important'</span>) -&gt;
    addStyle elClasses.active,
      backgroundColor: i <span class="hljs-string">'transparent'</span>
      backgroundImage: i <span class="hljs-string">'none'</span>
      boxSizing:       i <span class="hljs-string">'border-box'</span>
      border:          i <span class="hljs-string">'none'</span>
      outline:         i <span class="hljs-string">'none'</span>
      padding:         i <span class="hljs-string">'0'</span>
      transformStyle:  i p3d
      mask:            i <span class="hljs-string">'none'</span>
      position:          <span class="hljs-string">'relative'</span>

    addStyle elClasses.clone,
      margin:    i <span class="hljs-string">'0'</span>
      boxSizing: i <span class="hljs-string">'border-box'</span>
      overflow:  i <span class="hljs-string">'hidden'</span>
      display:   i <span class="hljs-string">'block'</span>

    addStyle elClasses.holder,
      width:          <span class="hljs-string">'100%'</span>
      position:       <span class="hljs-string">'absolute'</span>
      top:            <span class="hljs-string">'0'</span>
      bottom:         <span class="hljs-string">'0'</span>
      transformStyle: p3d

    addStyle elClasses.stage,
      width:          <span class="hljs-string">'100%'</span>
      height:         <span class="hljs-string">'100%'</span>
      position:       <span class="hljs-string">'absolute'</span>
      transform:      <span class="hljs-string">'translate3d(-9999px, 0, 0)'</span>
      margin:         <span class="hljs-string">'0'</span>
      padding:        <span class="hljs-string">'0'</span>
      transformStyle: p3d</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Each anchor needs a particular perspective origin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> {Left: <span class="hljs-string">'0% 50%'</span>, Right: <span class="hljs-string">'100% 50%'</span>, Top: <span class="hljs-string">'50% 0%'</span>, Bottom: <span class="hljs-string">'50% 100%'</span>}
      addStyle elClasses[<span class="hljs-string">'stage'</span> + k], perspectiveOrigin: v

    addStyle elClasses.shader,
      width:              <span class="hljs-string">'100%'</span>
      height:             <span class="hljs-string">'100%'</span>
      position:           <span class="hljs-string">'absolute'</span>
      opacity:            <span class="hljs-string">'0'</span>
      top:                <span class="hljs-string">'0'</span>
      left:               <span class="hljs-string">'0'</span>
      pointerEvents:      <span class="hljs-string">'none'</span>
      transitionProperty: <span class="hljs-string">'opacity'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Linear gradient directions depend on their anchor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorList
      addStyle elClasses[<span class="hljs-string">'shader'</span> + capitalize anchor], background: getGradient anchor

    addStyle elClasses.content,
      margin:    i <span class="hljs-string">'0'</span>
      position:  i <span class="hljs-string">'relative'</span>
      float:     i <span class="hljs-string">'none'</span>
      boxSizing: i <span class="hljs-string">'border-box'</span>
      overflow:  i <span class="hljs-string">'hidden'</span>

    addStyle elClasses.mask,
      width:              <span class="hljs-string">'100%'</span>
      height:             <span class="hljs-string">'100%'</span>
      position:           <span class="hljs-string">'absolute'</span>
      overflow:           <span class="hljs-string">'hidden'</span>
      transform:          <span class="hljs-string">'translate3d(0, 0, 0)'</span>
      outline:            <span class="hljs-string">'1px solid transparent'</span>

    addStyle elClasses.panel,
      width:              <span class="hljs-string">'100%'</span>
      height:             <span class="hljs-string">'100%'</span>
      padding:            <span class="hljs-string">'0'</span>
      position:           <span class="hljs-string">'absolute'</span>
      transitionProperty: css.transformProp
      transformOrigin:    <span class="hljs-string">'left'</span>
      transformStyle:     p3d

    addStyle elClasses.panelH, transformOrigin: <span class="hljs-string">'top'</span>
    addStyle <span class="hljs-string">"<span class="hljs-subst">#{ elClasses.stageRight }</span> .<span class="hljs-subst">#{ elClasses.panel }</span>"</span>, transformOrigin: <span class="hljs-string">'right'</span>
    addStyle <span class="hljs-string">"<span class="hljs-subst">#{ elClasses.stageBottom }</span> .<span class="hljs-subst">#{ elClasses.panel }</span>"</span>, transformOrigin: <span class="hljs-string">'bottom'</span>

  styleEl      = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'style'</span>
  styleEl.type = <span class="hljs-string">'text/css'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Once the style buffer is ready, it’s appended to the document as a stylesheet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> styleEl.styleSheet
    styleEl.styleSheet.cssText = styleBuffer
  <span class="hljs-keyword">else</span>
    styleEl.appendChild <span class="hljs-built_in">document</span>.createTextNode styleBuffer

  <span class="hljs-built_in">document</span>.head.appendChild styleEl</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h1 id="defaults">Defaults</h1>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>These defaults are used by all OriDomi instances unless overridden.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>defaults =</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>The number of vertical panels (for folding left or right).
You can use either an integer, or an array of percentages if you want custom
panel widths, e.g. <code>[20, 10, 10, 20, 10, 20, 10]</code>.
The numbers must add up to 100 (or near it, so you can use values like
<code>[33, 33, 33]</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  vPanels: <span class="hljs-number">3</span></pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>The number of horizontal panels (for folding top or bottom) or an array of percentages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hPanels: <span class="hljs-number">3</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>The determines the distance in pixels (z axis) of the camera/viewer to the paper.
The smaller the value, the more distorted and exaggerated the effects will appear.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  perspective: <span class="hljs-number">1000</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>The default shading style is hard, which shows distinct creases in the paper.
Other options include <code>&#39;soft&#39;</code> – for a smoother, more rounded look – or <code>false</code>
to disable shading altogether for a flat look.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shading: <span class="hljs-string">'hard'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Determines the duration of all animations in milliseconds.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  speed: <span class="hljs-number">700</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Configurable maximum angle for effects. With most effects, exceeding 90/-90 usually
makes the element wrap around and pass through itself leading to some glitchy visuals.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  maxAngle: <span class="hljs-number">90</span></pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Ripple mode causes effects to fold in a staggered, cascading manner.
<code>1</code> indicates a forward cascade, <code>2</code> is backwards. It is disabled by default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ripple: <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>This CSS class is applied to OriDomi elements so they can be easily targeted later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  oriDomiClass: libName.toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>This is a multiplier that determines the darkness of shading.
If you need subtler shading, set this to a value below 1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shadingIntensity: <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>This option allows you to supply the name of a CSS easing method or a
cubic bezier formula for customized animation easing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  easingMethod: <span class="hljs-string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Number of pixels to offset each panel to prevent small gaps from appearing
between them. This is configurable if you have a need for precision.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  gapNudge: <span class="hljs-number">1.5</span></pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Allows the user to fold the element via touch or mouse.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchEnabled: <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Coefficient of touch/drag action’s distance delta. Higher numbers cause more movement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchSensitivity: <span class="hljs-number">.25</span></pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Custom callbacks for touch/drag events. Each one is invoked with a relevant
value so they can be used to manipulate objects outside of the OriDomi
instance (e.g. sliding panels). x values are returned when folding left and
right, y values for top and bottom. The second argument passed is the original
touch or mouse event. These are empty functions by default. Invoked with
starting coordinate as first argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchStartCallback: noOp</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Invoked with the folded angle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchMoveCallback: noOp</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Invoked with ending point.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  touchEndCallback: noOp</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <h1 id="constructor">Constructor</h1>

            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OriDomi</span></span>

  constructor: <span class="hljs-function"><span class="hljs-params">(@el, options = {})</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> isSupported</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Fix constructor calls made without <code>new</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OriDomi @el, options <span class="hljs-keyword">unless</span> @ <span class="hljs-keyword">instanceof</span> OriDomi</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Support selector strings as well as elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @el = <span class="hljs-built_in">document</span>.querySelector @el <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> @el <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Make sure element is valid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">unless</span> @el <span class="hljs-keyword">and</span> @el.nodeType <span class="hljs-keyword">is</span> <span class="hljs-number">1</span>
      <span class="hljs-built_in">console</span>?.warn <span class="hljs-string">"<span class="hljs-subst">#{ libName }</span>: First argument must be a DOM element"</span>
      <span class="hljs-keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Fill in passed options with defaults.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_config = <span class="hljs-keyword">new</span> -&gt;
      <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> defaults
        <span class="hljs-keyword">if</span> k <span class="hljs-keyword">of</span> options
          @[k] = options[k]
        <span class="hljs-keyword">else</span>
          @[k] = v
      @</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>The ripple setting is converted to a number to allow boolean settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_config.ripple = Number @_config.ripple</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>The queue holds animation sequences.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_queue   = []
    @_panels  = {}
    @_stages  = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Set the starting anchor to left.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_lastOp  = anchor: anchorList[<span class="hljs-number">0</span>]
    @_shading = @_config.shading</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Alias <code>shading: true</code> as hard shading.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_shading = <span class="hljs-string">'hard'</span> <span class="hljs-keyword">if</span> @_shading <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>The shader elements are constructed in a conditional so the process can be
skipped if shading is disabled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @_shading
      @_shaders    = {}
      shaderProtos = {}
      shaderProto  = createEl <span class="hljs-string">'shader'</span>
      shaderProto.style[css.transitionDuration]       = @_config.speed + <span class="hljs-string">'ms'</span>
      shaderProto.style[css.transitionTimingFunction] = @_config.easingMethod

    stageProto = createEl <span class="hljs-string">'stage'</span>
    stageProto.style[css.perspective] = @_config.perspective + <span class="hljs-string">'px'</span>

    <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorList</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Each anchor has a unique set of panels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_panels[anchor] = []
      @_stages[anchor] = cloneEl stageProto, <span class="hljs-literal">false</span>, <span class="hljs-string">'stage'</span> + capitalize anchor
      <span class="hljs-keyword">if</span> @_shading
        @_shaders[anchor] = {}
        <span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">in</span> anchorListV
          @_shaders[anchor][side] = [] <span class="hljs-keyword">for</span> side <span class="hljs-keyword">in</span> anchorListV
        <span class="hljs-keyword">else</span>
          @_shaders[anchor][side] = [] <span class="hljs-keyword">for</span> side <span class="hljs-keyword">in</span> anchorListH

        shaderProtos[anchor] = cloneEl shaderProto, <span class="hljs-literal">false</span>, <span class="hljs-string">'shader'</span> + capitalize anchor

    contentHolder = cloneEl @el, <span class="hljs-literal">true</span>, <span class="hljs-string">'content'</span>

    maskProto = createEl <span class="hljs-string">'mask'</span>
    maskProto.appendChild contentHolder

    panelProto = createEl <span class="hljs-string">'panel'</span>
    panelProto.style[css.transitionDuration]       = @_config.speed + <span class="hljs-string">'ms'</span>
    panelProto.style[css.transitionTimingFunction] = @_config.easingMethod</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>These arrays store panel offsets so they don’t have to be computed twice
for each axis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    offsets = left: [], top: []</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>This loop builds all of the panels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> axis <span class="hljs-keyword">in</span> [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>]
      <span class="hljs-keyword">if</span> axis <span class="hljs-keyword">is</span> <span class="hljs-string">'x'</span>
        anchorSet   = anchorListV
        metric      = <span class="hljs-string">'width'</span>
        classSuffix = <span class="hljs-string">'V'</span>
      <span class="hljs-keyword">else</span>
        anchorSet   = anchorListH
        metric      = <span class="hljs-string">'height'</span>
        classSuffix = <span class="hljs-string">'H'</span>

      panelConfig = @_config[panelKey = classSuffix.toLowerCase() + <span class="hljs-string">'Panels'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>If the panel set configuration is an integer (as it is by default),
an array is filled with equal percentages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> panelConfig <span class="hljs-keyword">is</span> <span class="hljs-string">'number'</span>
        count       = Math.abs parseInt panelConfig, <span class="hljs-number">10</span>
        percent     = <span class="hljs-number">100</span> / count
        panelConfig = @_config[panelKey] = (percent <span class="hljs-keyword">for</span> [<span class="hljs-number">0.</span>..count])
      <span class="hljs-keyword">else</span>
        count = panelConfig.length
        <span class="hljs-keyword">unless</span> <span class="hljs-number">99</span> &lt;= panelConfig.reduce(<span class="hljs-function"><span class="hljs-params">(p, c)</span> -&gt;</span> p + c) &lt;= <span class="hljs-number">100.1</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"<span class="hljs-subst">#{ libName }</span>: Panel percentages do not sum to 100"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Clone a new mask element and append it to a panel element prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      mask = cloneEl maskProto, <span class="hljs-literal">true</span>, <span class="hljs-string">'mask'</span> + classSuffix

      <span class="hljs-keyword">if</span> @_shading
        mask.appendChild shaderProtos[anchor] <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorSet

      proto = cloneEl panelProto, <span class="hljs-literal">false</span>, <span class="hljs-string">'panel'</span> + classSuffix
      proto.appendChild mask

      <span class="hljs-keyword">for</span> anchor, rightOrBottom <span class="hljs-keyword">in</span> anchorSet
        <span class="hljs-keyword">for</span> panelN <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..count]
          panel   = proto.cloneNode <span class="hljs-literal">true</span>
          content = panel.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>]
          content.style.width = content.style.height = <span class="hljs-string">'100%'</span>

          <span class="hljs-keyword">if</span> rightOrBottom
            panel.style[css.origin] = anchor</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Panels on the right and bottom axes are placed backwards.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            index = panelConfig.length - panelN - <span class="hljs-number">1</span>
            prev  = index + <span class="hljs-number">1</span>
          <span class="hljs-keyword">else</span>
            index = panelN
            prev  = index - <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>The inner content of each panel is offset relative to the panel
index to display a contiguous composition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> panelN <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
              offsets[anchor].push <span class="hljs-number">0</span>
            <span class="hljs-keyword">else</span>
              offsets[anchor].push (offsets[anchor][prev] - <span class="hljs-number">100</span>) * (panelConfig[prev] / panelConfig[index])

          <span class="hljs-keyword">if</span> panelN <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
            panel.style[anchor] = <span class="hljs-string">'0'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Only the first panel has its size set to the nominal target percentage.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            panel.style[metric] = panelConfig[index] + <span class="hljs-string">'%'</span>
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Each subsequent panel is offset by its predecessor/parent’s size.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            panel.style[anchor] = <span class="hljs-string">'100%'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Subsequent panels have their percentages set relative to their
parent panel’s percentage to counteract it in an absolute sense.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            panel.style[metric] = panelConfig[index] / panelConfig[prev] * <span class="hljs-number">100</span> + <span class="hljs-string">'%'</span>

          <span class="hljs-keyword">if</span> @_shading
            <span class="hljs-keyword">for</span> a, i <span class="hljs-keyword">in</span> anchorSet
              @_shaders[anchor][a][panelN] = panel.children[<span class="hljs-number">0</span>].children[i + <span class="hljs-number">1</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>The inner content retains the original dimensions of the element
while being inside a small slice. By manipulating the number based
on the total number of panels and the absolute percentage, the size
reduction of the parent is undone and sizing flexibility is achieved.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          content.style[metric] =
            content.style[<span class="hljs-string">'max'</span> + capitalize metric] =
              (count / panelConfig[index] * <span class="hljs-number">10000</span> / count) + <span class="hljs-string">'%'</span>

          content.style[anchorSet[<span class="hljs-number">0</span>]] = offsets[anchorSet[<span class="hljs-number">0</span>]][index] + <span class="hljs-string">'%'</span>

          @_transformPanel panel, <span class="hljs-number">0</span>, anchor
          @_panels[anchor][panelN] = panel</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Panels are nested inside each other.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          @_panels[anchor][panelN - <span class="hljs-number">1</span>].appendChild panel <span class="hljs-keyword">unless</span> panelN <span class="hljs-keyword">is</span> <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Append the first panel to each stage.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        @_stages[anchor].appendChild @_panels[anchor][<span class="hljs-number">0</span>]

    @_stageHolder = createEl <span class="hljs-string">'holder'</span>
    @_stageHolder.setAttribute <span class="hljs-string">'aria-hidden'</span>, <span class="hljs-string">'true'</span>
    @_stageHolder.appendChild @_stages[anchor] <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorList</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Override default styling if original positioning is absolute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>.getComputedStyle(@el).position <span class="hljs-keyword">is</span> <span class="hljs-string">'absolute'</span>
      @el.style.position = <span class="hljs-string">'absolute'</span>

    @el.classList.add elClasses.active
    showEl @_stages.left</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>The original element is cloned and hidden via transforms so the dimensions
of the OriDomi content are maintained by it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_cloneEl = cloneEl @el, <span class="hljs-literal">true</span>, <span class="hljs-string">'clone'</span>
    @_cloneEl.classList.remove elClasses.active
    hideEl @_cloneEl</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Once the clone is stored the original element is emptied and appended with
the clone and the OriDomi content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @el.innerHTML = <span class="hljs-string">''</span>
    @el.appendChild @_cloneEl
    @el.appendChild @_stageHolder</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>This ensures mouse events work correctly when panels are transformed
away from the viewer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @el.parentNode.style[css.transformStyle] = <span class="hljs-string">'preserve-3d'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>An effect method is called since touch events rely on using the last
method called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @accordion <span class="hljs-number">0</span>
    @setRipple @_config.ripple <span class="hljs-keyword">if</span> @_config.ripple
    @enableTouch() <span class="hljs-keyword">if</span> @_config.touchEnabled</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <h1 id="internal-methods">Internal Methods</h1>

            </div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>This method is called for the action shifted off the queue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _step: <span class="hljs-function">=&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Return if the composition is currently in transition or the queue is empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> @_inTrans <span class="hljs-keyword">or</span> !@_queue.length
    @_inTrans = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Destructure action arguments from the front of the queue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    [fn, angle, anchor, options] = @_queue.shift()
    @unfreeze() <span class="hljs-keyword">if</span> @isFrozen</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>A local function for the next action is created should the call need to be
deferred (if the stage is folded up or on the wrong anchor).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function">    <span class="hljs-title">next</span> = =&gt;</span>
      @_setCallback {angle, anchor, options, fn}
      args = [angle, anchor, options]
      args.shift() <span class="hljs-keyword">if</span> fn.length &lt; <span class="hljs-number">3</span>
      fn.apply @, args

    <span class="hljs-keyword">if</span> @isFoldedUp
      <span class="hljs-keyword">if</span> fn.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span>
        next()
      <span class="hljs-keyword">else</span>
        @_unfold next
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">isnt</span> @_lastOp.anchor
      @_stageReset anchor, next
    <span class="hljs-keyword">else</span>
      next()</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>This method tests if the called action is identical to the previous one.
If two identical operations were called in a row, the transition callback
wouldn’t be called due to no animation taking place. This method reasons if
movement has taken place, avoiding this pitfall of transition listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _isIdenticalOperation: <span class="hljs-function"><span class="hljs-params">(op)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">unless</span> @_lastOp.fn
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> @_lastOp.reset
    (<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> @_lastOp[key] <span class="hljs-keyword">isnt</span> op[key]) <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> [<span class="hljs-string">'angle'</span>, <span class="hljs-string">'anchor'</span>, <span class="hljs-string">'fn'</span>]
    (<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> v <span class="hljs-keyword">isnt</span> @_lastOp.options[k] <span class="hljs-keyword">and</span> k <span class="hljs-keyword">isnt</span> <span class="hljs-string">'callback'</span>) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> op.options
    <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>This method normalizes callback handling for all public methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setCallback: <span class="hljs-function"><span class="hljs-params">(operation)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>If there was no transformation, invoke the callback immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> !@_config.speed <span class="hljs-keyword">or</span> @_isIdenticalOperation operation
      @_conclude operation.options.callback</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Otherwise, attach an event listener to be called on the transition’s end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span>
      @_panels[@_lastOp.anchor][<span class="hljs-number">0</span>].addEventListener css.transitionEnd, @_onTransitionEnd, <span class="hljs-literal">false</span>

    (@_lastOp = operation).reset = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Handler called when a CSS transition ends.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onTransitionEnd: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Remove the event listener immediately to prevent bubbling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    e.currentTarget.removeEventListener css.transitionEnd, @_onTransitionEnd, <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Initialize the transition teardown process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_conclude @_lastOp.options.callback, e</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Used to handle the end process of transitions and to initialize queued operations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _conclude: <span class="hljs-function"><span class="hljs-params">(cb, event)</span> =&gt;</span>
    defer =&gt;
      @_inTrans = <span class="hljs-literal">false</span>
      @_step()
      cb? event, @</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Transforms a given element based on angle, anchor, and fracture boolean.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _transformPanel: <span class="hljs-function"><span class="hljs-params">(el, angle, anchor, fracture)</span> -&gt;</span>
    x = y = z = <span class="hljs-number">0</span>
    <span class="hljs-keyword">switch</span> anchor
      <span class="hljs-keyword">when</span> <span class="hljs-string">'left'</span>
        y = angle
        transPrefix = <span class="hljs-string">'X(-'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'right'</span>
        y = -angle
        transPrefix = <span class="hljs-string">'X('</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'top'</span>
        x = -angle
        transPrefix = <span class="hljs-string">'Y(-'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'bottom'</span>
        x = angle
        transPrefix = <span class="hljs-string">'Y('</span></pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Rotate on every axis in fracture mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    x = y = z = angle <span class="hljs-keyword">if</span> fracture

    el.style[css.transform] = <span class="hljs-string">"
                              rotateX(<span class="hljs-subst">#{ x }</span>deg)
                              rotateY(<span class="hljs-subst">#{ y }</span>deg)
                              rotateZ(<span class="hljs-subst">#{ z }</span>deg)
                              translate<span class="hljs-subst">#{ transPrefix }</span><span class="hljs-subst">#{ @_config.gapNudge }</span>px)
                              "</span></pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>This validates a given angle by making sure it’s a float and by
keeping it within the maximum range specified in the instance settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _normalizeAngle: <span class="hljs-function"><span class="hljs-params">(angle)</span> -&gt;</span>
    angle = parseFloat angle, <span class="hljs-number">10</span>
    max   = @_config.maxAngle
    <span class="hljs-keyword">if</span> isNaN angle
      <span class="hljs-number">0</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> angle &gt; max
      max
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> angle &lt; -max
      -max
    <span class="hljs-keyword">else</span>
      angle</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Allows other methods to change the transition duration/delay or disable it altogether.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setTrans: <span class="hljs-function"><span class="hljs-params">(duration, delay, anchor = @_lastOp.anchor)</span> -&gt;</span>
    @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i, len)</span> =&gt;</span> @_setPanelTrans anchor, arguments..., duration, delay</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>This method changes the transition duration and delay of panels and shaders.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setPanelTrans: <span class="hljs-function"><span class="hljs-params">(anchor, panel, i, len, duration, delay)</span> -&gt;</span>
    delayMs =</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Delay is a <code>ripple</code> value. The milliseconds are derived based on the
speed setting and the number of panels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">switch</span> delay
        <span class="hljs-keyword">when</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">when</span> <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> @_config.speed / len * i
        <span class="hljs-keyword">when</span> <span class="hljs-number">2</span> <span class="hljs-keyword">then</span> @_config.speed / len * (len - i - <span class="hljs-number">1</span>)

    panel.style[css.transitionDuration] = duration + <span class="hljs-string">'ms'</span>
    panel.style[css.transitionDelay]    = delayMs  + <span class="hljs-string">'ms'</span>
    <span class="hljs-keyword">if</span> @_shading
      <span class="hljs-keyword">for</span> side <span class="hljs-keyword">in</span> (<span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">in</span> anchorListV <span class="hljs-keyword">then</span> anchorListV <span class="hljs-keyword">else</span> anchorListH)
        shader = @_shaders[anchor][side][i]
        shader.style[css.transitionDuration] = duration + <span class="hljs-string">'ms'</span>
        shader.style[css.transitionDelay]    = delayMs  + <span class="hljs-string">'ms'</span>

    delayMs</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Determines a shader’s opacity based upon panel position, anchor, and angle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setShader: <span class="hljs-function"><span class="hljs-params">(n, anchor, angle)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Store the angle’s absolute value and generate an opacity based on <code>shadingIntensity</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    abs     = Math.abs angle
    opacity = abs / <span class="hljs-number">90</span> * @_config.shadingIntensity</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>With hard shading, opacity is reduced and <code>angle</code> is based on the global
<code>lastAngle</code> so all panels’ shaders share the same direction. Soft shaders
have alternating directions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @_shading <span class="hljs-keyword">is</span> <span class="hljs-string">'hard'</span>
      opacity *= <span class="hljs-number">.15</span>
      <span class="hljs-keyword">if</span> @_lastOp.angle &lt; <span class="hljs-number">0</span>
        angle = abs
      <span class="hljs-keyword">else</span>
        angle = -abs
    <span class="hljs-keyword">else</span>
      opacity *= <span class="hljs-number">.4</span></pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>This block makes sure left and top shaders appear for negative angles and right
and bottom shaders appear for positive ones.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">in</span> anchorListV
      <span class="hljs-keyword">if</span> angle &lt; <span class="hljs-number">0</span>
        a = opacity
        b = <span class="hljs-number">0</span>
      <span class="hljs-keyword">else</span>
        a = <span class="hljs-number">0</span>
        b = opacity
      @_shaders[anchor].left[n].style.opacity  = a
      @_shaders[anchor].right[n].style.opacity = b
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">if</span> angle &lt; <span class="hljs-number">0</span>
        a = <span class="hljs-number">0</span>
        b = opacity
      <span class="hljs-keyword">else</span>
        a = opacity
        b = <span class="hljs-number">0</span>
      @_shaders[anchor].top[n].style.opacity    = a
      @_shaders[anchor].bottom[n].style.opacity = b</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>This method shows the requested stage element and sets a reference to it as
the current stage.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _showStage: <span class="hljs-function"><span class="hljs-params">(anchor)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">isnt</span> @_lastOp.anchor
      hideEl @_stages[@_lastOp.anchor]
      @_lastOp.anchor = anchor
      @_lastOp.reset  = <span class="hljs-literal">true</span>
      @_stages[anchor].style[css.transform] = <span class="hljs-string">'translate3d('</span> +
        <span class="hljs-keyword">switch</span> anchor
          <span class="hljs-keyword">when</span> <span class="hljs-string">'left'</span>
            <span class="hljs-string">'0, 0, 0)'</span>
          <span class="hljs-keyword">when</span> <span class="hljs-string">'right'</span>
            <span class="hljs-string">"-<span class="hljs-subst">#{ @_config.vPanels.length }</span>px, 0, 0)"</span>
          <span class="hljs-keyword">when</span> <span class="hljs-string">'top'</span>
            <span class="hljs-string">'0, 0, 0)'</span>
          <span class="hljs-keyword">when</span> <span class="hljs-string">'bottom'</span>
            <span class="hljs-string">"0, -<span class="hljs-subst">#{ @_config.hPanels.length }</span>px, 0)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>If the composition needs to switch stages or fold up, it must first unfold
all panels to 0 degrees.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _stageReset: <span class="hljs-function"><span class="hljs-params">(anchor, cb)</span> =&gt;</span>
<span class="hljs-function">    <span class="hljs-title">fn</span> = <span class="hljs-params">(e)</span> =&gt;</span>
      e.currentTarget.removeEventListener css.transitionEnd, fn, <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> e
      @_showStage anchor
      defer cb</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>If already unfolded to 0, immediately invoke the change function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> fn() <span class="hljs-keyword">if</span> @_lastOp.angle <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    @_panels[@_lastOp.anchor][<span class="hljs-number">0</span>].addEventListener css.transitionEnd, fn, <span class="hljs-literal">false</span>

    @_iterate @_lastOp.anchor, <span class="hljs-function"><span class="hljs-params">(panel, i)</span> =&gt;</span>
      @_transformPanel panel, <span class="hljs-number">0</span>, @_lastOp.anchor
      @_setShader i, @_lastOp.anchor, <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> @_shading</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Converts a shorthand anchor name to a full one.
Numerical shorthands are based on CSS shorthand ordering.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _getLonghandAnchor: <span class="hljs-function"><span class="hljs-params">(shorthand)</span> -&gt;</span>
    <span class="hljs-keyword">switch</span> shorthand.toString()
      <span class="hljs-keyword">when</span> <span class="hljs-string">'left'</span>,   <span class="hljs-string">'l'</span>, <span class="hljs-string">'4'</span>
        <span class="hljs-string">'left'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'right'</span>,  <span class="hljs-string">'r'</span>, <span class="hljs-string">'2'</span>
        <span class="hljs-string">'right'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'top'</span>,    <span class="hljs-string">'t'</span>, <span class="hljs-string">'1'</span>
        <span class="hljs-string">'top'</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'bottom'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'3'</span>
        <span class="hljs-string">'bottom'</span>
      <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Left is always default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'left'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Gives the element a resize cursor to prompt the user to drag the mouse.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setCursor: <span class="hljs-function"><span class="hljs-params">(bool = @_touchEnabled)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> bool
      @el.style.cursor = css.grab
    <span class="hljs-keyword">else</span>
      @el.style.cursor = <span class="hljs-string">'default'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <h1 id="touch-drag-event-handlers">Touch / Drag Event Handlers</h1>

            </div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Adds or removes handlers from the element based on the boolean argument given.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setTouch: <span class="hljs-function"><span class="hljs-params">(toggle)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> toggle
      <span class="hljs-keyword">return</span> @ <span class="hljs-keyword">if</span> @_touchEnabled
      listenFn = <span class="hljs-string">'addEventListener'</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> @ <span class="hljs-keyword">unless</span> @_touchEnabled
      listenFn = <span class="hljs-string">'removeEventListener'</span>

    @_touchEnabled = toggle
    @_setCursor()</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Array of event type pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    eventPairs = [[<span class="hljs-string">'TouchStart'</span>, <span class="hljs-string">'MouseDown'</span>], [<span class="hljs-string">'TouchEnd'</span>, <span class="hljs-string">'MouseUp'</span>],
                  [<span class="hljs-string">'TouchMove'</span>, <span class="hljs-string">'MouseMove'</span>], [<span class="hljs-string">'TouchLeave'</span>, <span class="hljs-string">'MouseLeave'</span>]]</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Detect native <code>mouseleave</code> support.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mouseLeaveSupport = <span class="hljs-string">'onmouseleave'</span> <span class="hljs-keyword">of</span> <span class="hljs-built_in">window</span></pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Attach touch/drag event listeners in related pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> eventPair <span class="hljs-keyword">in</span> eventPairs
      <span class="hljs-keyword">for</span> eString <span class="hljs-keyword">in</span> eventPair
        <span class="hljs-keyword">unless</span> eString <span class="hljs-keyword">is</span> <span class="hljs-string">'TouchLeave'</span> <span class="hljs-keyword">and</span> !mouseLeaveSupport
          @el[listenFn] eString.toLowerCase(), @[<span class="hljs-string">'_on'</span> + eventPair[<span class="hljs-number">0</span>]], <span class="hljs-literal">false</span>
        <span class="hljs-keyword">else</span>
          @el[listenFn] <span class="hljs-string">'mouseout'</span>, @_onMouseOut, <span class="hljs-literal">false</span>
          <span class="hljs-keyword">break</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>This method is called when a finger or mouse button is pressed on the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onTouchStart: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> !@_touchEnabled <span class="hljs-keyword">or</span> @isFoldedUp
    e.preventDefault()</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Clear queued animations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @emptyQueue()</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Set a property to track touch starts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_touchStarted = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Change the cursor to the active <code>grabbing</code> state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @el.style.cursor = css.grabbing</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Disable tweening to enable instant 1 to 1 movement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_setTrans <span class="hljs-number">0</span>, <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Derive the axis to fold on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_touchAxis = <span class="hljs-keyword">if</span> @_lastOp.anchor <span class="hljs-keyword">in</span> anchorListV <span class="hljs-keyword">then</span> <span class="hljs-string">'x'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'y'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Set a reference to the last folded angle to accurately derive deltas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>] = @_lastOp.angle
    axis1 = <span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>1"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Determine the starting tap’s coordinate for touch and mouse events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> e.type <span class="hljs-keyword">is</span> <span class="hljs-string">'mousedown'</span>
      @[axis1] = e[<span class="hljs-string">"page<span class="hljs-subst">#{ @_touchAxis.toUpperCase() }</span>"</span>]
    <span class="hljs-keyword">else</span>
      @[axis1] = e.targetTouches[<span class="hljs-number">0</span>][<span class="hljs-string">"page<span class="hljs-subst">#{ @_touchAxis.toUpperCase() }</span>"</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Return that value to an external listener.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_config.touchStartCallback @[axis1], e</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Called on touch/mouse movement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onTouchMove: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> @_touchEnabled <span class="hljs-keyword">and</span> @_touchStarted
    e.preventDefault()</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Set a reference to the current x or y position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> e.type <span class="hljs-keyword">is</span> <span class="hljs-string">'mousemove'</span>
      current = e[<span class="hljs-string">"page<span class="hljs-subst">#{ @_touchAxis.toUpperCase() }</span>"</span>]
    <span class="hljs-keyword">else</span>
      current = e.targetTouches[<span class="hljs-number">0</span>][<span class="hljs-string">"page<span class="hljs-subst">#{ @_touchAxis.toUpperCase() }</span>"</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Calculate distance and multiply by <code>touchSensitivity</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    distance = (current - @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>1"</span>]) * @_config.touchSensitivity</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Calculate final delta based on starting angle, anchor, and what side of zero
the last operation was on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @_lastOp.angle &lt; <span class="hljs-number">0</span>
      <span class="hljs-keyword">if</span> @_lastOp.anchor <span class="hljs-keyword">is</span> <span class="hljs-string">'right'</span> <span class="hljs-keyword">or</span> @_lastOp.anchor <span class="hljs-keyword">is</span> <span class="hljs-string">'bottom'</span>
        delta = @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>] - distance
      <span class="hljs-keyword">else</span>
        delta = @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>] + distance
      delta = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> delta &gt; <span class="hljs-number">0</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">if</span> @_lastOp.anchor <span class="hljs-keyword">is</span> <span class="hljs-string">'right'</span> <span class="hljs-keyword">or</span> @_lastOp.anchor <span class="hljs-keyword">is</span> <span class="hljs-string">'bottom'</span>
        delta = @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>] + distance
      <span class="hljs-keyword">else</span>
        delta = @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>] - distance
      delta = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> delta &lt; <span class="hljs-number">0</span>


    @_lastOp.angle = delta = @_normalizeAngle delta
    @_lastOp.fn.call @, delta, @_lastOp.anchor, @_lastOp.options
    @_config.touchMoveCallback delta, e</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Teardown process when touch/drag event ends.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onTouchEnd: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> @_touchEnabled</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Restore the initial touch status and cursor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_touchStarted = @_inTrans = <span class="hljs-literal">false</span>
    @el.style.cursor = css.grab</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Enable transitions again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_setTrans @_config.speed, @_config.ripple</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Pass callback final coordinate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_config.touchEndCallback @[<span class="hljs-string">"_<span class="hljs-subst">#{ @_touchAxis }</span>Last"</span>], e</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>End folding when the mouse or finger leaves the composition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onTouchLeave: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> @_touchEnabled <span class="hljs-keyword">and</span> @_touchStarted
    @_onTouchEnd e</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>A fallback for browsers that don’t support <code>mouseleave</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _onMouseOut: <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> @_touchEnabled <span class="hljs-keyword">and</span> @_touchStarted
    @_onTouchEnd e <span class="hljs-keyword">if</span> e.toElement <span class="hljs-keyword">and</span> !@el.contains e.toElement</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>This method unfolds the composition after it’s been folded up. It’s private
and doesn’t use the decorator because it’s used internally by other methods
and skips the queue. Its public counterpart is a queued alias.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _unfold: <span class="hljs-function"><span class="hljs-params">(callback)</span> -&gt;</span>
    @_inTrans = <span class="hljs-literal">true</span>
    {anchor}  = @_lastOp
    @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i, len)</span> =&gt;</span>
      delay = @_setPanelTrans anchor, arguments..., @_config.speed, <span class="hljs-number">1</span>

      <span class="hljs-keyword">do</span> (panel, i, delay) =&gt;
        defer =&gt;
          @_transformPanel panel, <span class="hljs-number">0</span>, anchor
          @_setShader i, anchor, <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> @_shading

          setTimeout =&gt;
            showEl panel.children[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> len - <span class="hljs-number">1</span>
              @_inTrans = @isFoldedUp = <span class="hljs-literal">false</span>
              callback?()
              @_lastOp.fn    = @accordion
              @_lastOp.angle = <span class="hljs-number">0</span>

            defer =&gt; panel.style[css.transitionDuration] = @_config.speed

          , delay + @_config.speed * <span class="hljs-number">.25</span></pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>This method is used by many others to iterate among panels within a given anchor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _iterate: <span class="hljs-function"><span class="hljs-params">(anchor, fn)</span> -&gt;</span>
    fn.call @, panel, i, panels.length <span class="hljs-keyword">for</span> panel, i <span class="hljs-keyword">in</span> panels = @_panels[anchor]</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <h1 id="public-methods">Public Methods</h1>

            </div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Enables touch events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  enableTouch: <span class="hljs-function">-&gt;</span>
    @_setTouch <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Disables touch events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  disableTouch: <span class="hljs-function">-&gt;</span>
    @_setTouch <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Public setter for transition durations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setSpeed: <span class="hljs-function"><span class="hljs-params">(speed)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorList
      @_setTrans (@_config.speed = speed), @_config.ripple, anchor
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Disables OriDomi slicing by showing the original, untouched target element.
This is useful for certain user interactions on the inner content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  freeze: <span class="hljs-function"><span class="hljs-params">(callback)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Return if already frozen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @isFrozen
      callback?()
    <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Make sure to reset folding first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_stageReset @_lastOp.anchor, <span class="hljs-function">=&gt;</span>
        @isFrozen = <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Swap the visibility of the elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideEl @_stageHolder
        showEl @_cloneEl
        @_setCursor <span class="hljs-literal">false</span>
        callback?()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Restores the OriDomi version of the element for folding purposes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unfreeze: <span class="hljs-function">-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Only unfreeze if already frozen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @isFrozen
      @isFrozen = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Swap the visibility of the elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hideEl @_cloneEl
      showEl @_stageHolder
      @_setCursor()</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Set <code>lastAngle</code> to 0 so an immediately subsequent call to <code>freeze</code> triggers the callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_lastOp.angle = <span class="hljs-number">0</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Removes the OriDomi element and restores the original element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  destroy: <span class="hljs-function"><span class="hljs-params">(callback)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>First restore the original element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @freeze =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Remove event listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_setTouch <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Remove the data reference if using jQuery.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $.data @el, baseName, <span class="hljs-literal">null</span> <span class="hljs-keyword">if</span> $</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Remove the OriDomi element from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @el.innerHTML = @_cloneEl.innerHTML</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Reset original styling.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @el.classList.remove elClasses.active
      callback?()
    <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Empties the queue should you want to cancel scheduled animations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emptyQueue: <span class="hljs-function">-&gt;</span>
    @_queue = []
    defer =&gt; @_inTrans = <span class="hljs-literal">false</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>Enable or disable ripple. 1 is forwards, 2 is backwards, 0 is disabled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setRipple: <span class="hljs-function"><span class="hljs-params">(dir = <span class="hljs-number">1</span>)</span> -&gt;</span>
    @_config.ripple = Number dir
    @setSpeed @_config.speed
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>Setter method for <code>maxAngle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constrainAngle: <span class="hljs-function"><span class="hljs-params">(angle)</span> -&gt;</span>
    @_config.maxAngle = parseFloat(angle, <span class="hljs-number">10</span>) <span class="hljs-keyword">or</span> defaults.maxAngle
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>Pause in the midst of an animation sequence, in milliseconds.
E.g.: el.reveal(20).wait(5000).accordion(-33)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  wait: <span class="hljs-function"><span class="hljs-params">(ms)</span> -&gt;</span>
<span class="hljs-function">    <span class="hljs-title">fn</span> = =&gt;</span> setTimeout @_conclude, ms
    <span class="hljs-keyword">if</span> @_inTrans
      @_queue.push [fn, @_lastOp.angle, @_lastOp.anchor, @_lastOp.options]
    <span class="hljs-keyword">else</span>
      fn()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>This method is used to externally manipulate the styling or contents of the
composition. Manipulation instructions can be supplied via a function (invoked
with each panel element), or a map of selectors with instructions.
Instruction values can be text to implicitly update <code>innerHTML</code> content or
objects with <code>style</code> and/or <code>content</code> keys. Style keys should contain object
literals with camel-cased CSS properties as keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  modifyContent: <span class="hljs-function"><span class="hljs-params">(fn)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> fn <span class="hljs-keyword">isnt</span> <span class="hljs-string">'function'</span>
      selectors = fn
<span class="hljs-function">
      <span class="hljs-title">set</span> = <span class="hljs-params">(el, content, style)</span> -&gt;</span>
        el.innerHTML = content <span class="hljs-keyword">if</span> content
        <span class="hljs-keyword">if</span> style
          el.style[key] = value <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> style
          <span class="hljs-literal">null</span>
<span class="hljs-function">
      <span class="hljs-title">fn</span> = <span class="hljs-params">(el)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> selector, value <span class="hljs-keyword">of</span> selectors
          content = style = <span class="hljs-literal">null</span>
          <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> value <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
            content = value
          <span class="hljs-keyword">else</span>
            {content, style} = value

          <span class="hljs-keyword">if</span> selector <span class="hljs-keyword">is</span> <span class="hljs-string">''</span>
            set el, content, style
            <span class="hljs-keyword">continue</span>

          set match, content, style <span class="hljs-keyword">for</span> match <span class="hljs-keyword">in</span> el.querySelectorAll selector

        <span class="hljs-literal">null</span>

    <span class="hljs-keyword">for</span> anchor <span class="hljs-keyword">in</span> anchorList
      <span class="hljs-keyword">for</span> panel, i <span class="hljs-keyword">in</span> @_panels[anchor]
        fn panel.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>], i, anchor
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <h1 id="effect-methods">Effect Methods</h1>

            </div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>Base effect with alternating peaks and valleys.
<code>reveal</code> relies on it by calling it with <code>sticky: true</code> to keep the first
panel flat.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  accordion: prep (angle, anchor, options) -&gt;
    @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i)</span> =&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>With an odd-numbered panel, reverse the angle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> !options.twist
        deg = -angle
      <span class="hljs-keyword">else</span>
        deg = angle</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>If sticky, keep the first panel flat.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> options.sticky
        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
          deg = <span class="hljs-number">0</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> options.stairs
          deg *= <span class="hljs-number">2</span>
      <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Double the angle to counteract the angle of the parent panel.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        deg *= <span class="hljs-number">2</span> <span class="hljs-keyword">unless</span> i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>In stairs mode, keep all the angles on the same side of 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      deg *= <span class="hljs-number">-1</span> <span class="hljs-keyword">if</span> options.stairs</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Set the CSS transformation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_transformPanel panel, deg, anchor, options.fracture

      <span class="hljs-keyword">if</span> @_shading
        <span class="hljs-keyword">if</span> options.twist <span class="hljs-keyword">or</span> options.fracture <span class="hljs-keyword">or</span> (i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> options.sticky)
          @_setShader i, anchor, <span class="hljs-number">0</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> Math.abs(deg) <span class="hljs-keyword">isnt</span> <span class="hljs-number">180</span>
          @_setShader i, anchor, deg</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>This effect appears to bend rather than fold the paper. Its curves can
appear smoother with higher panel counts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  curl: prep (angle, anchor, options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Reduce the angle based on the number of panels in this axis.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    angle /= <span class="hljs-keyword">if</span> anchor <span class="hljs-keyword">in</span> anchorListV <span class="hljs-keyword">then</span> @_config.vPanels.length <span class="hljs-keyword">else</span> @_config.hPanels.length

    @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i)</span> =&gt;</span>
      @_transformPanel panel, angle, anchor
      @_setShader i, anchor, <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> @_shading</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Lifts up all panels after the first one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ramp: prep (angle, anchor, options) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Rotate the second panel for the lift up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_transformPanel @_panels[anchor][<span class="hljs-number">1</span>], angle, anchor</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>For all but the second panel, set the angle to 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i)</span> =&gt;</span>
      @_transformPanel panel, <span class="hljs-number">0</span>, anchor <span class="hljs-keyword">if</span> i <span class="hljs-keyword">isnt</span> <span class="hljs-number">1</span>
      @_setShader i, anchor, <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> @_shading</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Hides the element by folding each panel in a cascade of animations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  foldUp: prep (anchor, callback) -&gt;
    <span class="hljs-keyword">return</span> callback?() <span class="hljs-keyword">if</span> @isFoldedUp
    @_stageReset anchor, <span class="hljs-function">=&gt;</span>
      @_inTrans = @isFoldedUp = <span class="hljs-literal">true</span>

      @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i, len)</span> =&gt;</span>
        duration  = @_config.speed
        duration /= <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
        delay     = @_setPanelTrans anchor, arguments..., duration, <span class="hljs-number">2</span>

        <span class="hljs-keyword">do</span> (panel, i, delay) =&gt;
          defer =&gt;
            @_transformPanel panel, (<span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-number">90</span> <span class="hljs-keyword">else</span> <span class="hljs-number">170</span>), anchor
            setTimeout =&gt;
              <span class="hljs-keyword">if</span> i <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
                @_inTrans = <span class="hljs-literal">false</span>
                callback?()
              <span class="hljs-keyword">else</span>
                hideEl panel.children[<span class="hljs-number">0</span>]

            , delay + @_config.speed * <span class="hljs-number">.25</span></pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>This is the queued version of <code>_unfold</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unfold: prep @::_unfold</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>For custom folding behavior, you can pass a function to <code>map()</code> that will
determine the folding angle applied to each panel. The passed function
is supplied with the input angle, the panel index, and the number of
panels in the active anchor. Calling map returns a new function bound to
the instance and the lambda, e.g. <code>oridomi.map(randomFn)(30).reveal(20)</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  map: <span class="hljs-function"><span class="hljs-params">(fn)</span> -&gt;</span>
    prep (angle, anchor, options) =&gt;
      @_iterate anchor, <span class="hljs-function"><span class="hljs-params">(panel, i, len)</span> =&gt;</span>
        @_transformPanel panel, fn(angle, i, len), anchor, options.fracture
    .bind @</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <h1 id="convenience-methods">Convenience Methods</h1>

            </div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Resets all panels back to zero degrees.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset: <span class="hljs-function"><span class="hljs-params">(callback)</span> -&gt;</span>
    @accordion <span class="hljs-number">0</span>, {callback}</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>Simply proxy for calling <code>accordion</code> with <code>sticky</code> enabled.
Keeps first panel flat on page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reveal: <span class="hljs-function"><span class="hljs-params">(angle, anchor, options = {})</span> -&gt;</span>
    options.sticky = <span class="hljs-literal">true</span>
    @accordion angle, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Proxy to enable stairs mode on <code>accordion</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stairs: <span class="hljs-function"><span class="hljs-params">(angle, anchor, options = {})</span> -&gt;</span>
    options.stairs = options.sticky = <span class="hljs-literal">true</span>
    @accordion angle, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>The composition is split apart by its panels rather than folded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fracture: <span class="hljs-function"><span class="hljs-params">(angle, anchor, options = {})</span> -&gt;</span>
    options.fracture = <span class="hljs-literal">true</span>
    @accordion angle, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>Similar to <code>fracture</code>, but the panels are twisted as well.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  twist: <span class="hljs-function"><span class="hljs-params">(angle, anchor, options = {})</span> -&gt;</span>
    options.fracture = options.twist = <span class="hljs-literal">true</span>
    @accordion angle / <span class="hljs-number">10</span>, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Convenience proxy to accordion-fold instance to maximum angle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  collapse: <span class="hljs-function"><span class="hljs-params">(anchor, options = {})</span> -&gt;</span>
    options.sticky = <span class="hljs-literal">false</span>
    @accordion -@_config.maxAngle, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Same as <code>collapse</code>, but uses positive angle for slightly different effect.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  collapseAlt: <span class="hljs-function"><span class="hljs-params">(anchor, options = {})</span> -&gt;</span>
    options.sticky = <span class="hljs-literal">false</span>
    @accordion @_config.maxAngle, anchor, options</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <h1 id="statics">Statics</h1>

            </div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Set a version flag for easy external retrieval.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @VERSION = <span class="hljs-string">'1.1.5'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Externally reveal if OriDomi is supported by the browser.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @isSupported = isSupported</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Expose the OriDomi constructor via CommonJS, AMD, or the window object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> <span class="hljs-built_in">module</span>?.exports
  <span class="hljs-built_in">module</span>.exports = OriDomi
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> define?.amd
  define -&gt; OriDomi
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">window</span>.OriDomi = OriDomi</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <h1 id="plugin-bridge">Plugin Bridge</h1>

            </div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>Only create bridge if jQuery (or an imitation supporting <code>data()</code>) exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> $</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>Attach an <code>OriDomi</code> method to <code>$</code>‘s prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$::oriDomi = <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Return selection if OriDomi is unsupported by the browser.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> @ <span class="hljs-keyword">unless</span> isSupported
  <span class="hljs-keyword">return</span> $.data @[<span class="hljs-number">0</span>], baseName <span class="hljs-keyword">if</span> options <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>If <code>options</code> is a string, assume it’s a method call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> options <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
    methodName = options</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Check if method exists and warn if it doesn’t.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">unless</span> <span class="hljs-keyword">typeof</span> (method = OriDomi::[methodName]) <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
      <span class="hljs-built_in">console</span>?.warn <span class="hljs-string">"<span class="hljs-subst">#{ libName }</span>: No such method `<span class="hljs-subst">#{ methodName }</span>`"</span>
      <span class="hljs-keyword">return</span> @

    <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> @

      <span class="hljs-keyword">unless</span> instance = $.data el, baseName
        instance = $.data el, baseName, <span class="hljs-keyword">new</span> OriDomi el, options</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Call the requested method with arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      method.apply instance, Array::slice.call(arguments)[<span class="hljs-number">1.</span>..]</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>If not calling a method, initialize OriDomi on the selection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> @</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>If the element in the selection already has an instance of OriDomi
attached to it, return the instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> instance = $.data el, baseName
        <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>Create an instance of OriDomi and attach it to the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.data el, baseName, <span class="hljs-keyword">new</span> OriDomi el, options</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Return the selection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
